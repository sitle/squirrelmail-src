<!doctype linuxdoc system>
<!--
 $Id$

 Copyright (c) 2005-2006 The SquirrelMail Project Team
 This file is part of SquirrelMail webmail interface documentation.

 SquirrelMail is free software; you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation; either version 2 of the License, or
 (at your option) any later version.

 SquirrelMail is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with SquirrelMail; if not, write to the Free Software
 Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
 02110-1301, USA
-->
<article>

<title>SquirrelMail Administrator's Manual
<author>
by the SquirrelMail Project Team:
<!-- put your name here -->
</author>
<date>$Date$
<abstract>
This document provides information about SquirrelMail webmail interface
installation and configuration procedures.
</abstract>

<toc>

<p>
Document version: $Revision$

<sect>Overview
<p>
SquirrelMail is a standards-based webmail package written in PHP. It includes
built-in pure PHP support for the IMAP and SMTP protocols, and all pages render
in pure HTML 4.0 (with no JavaScript required) for maximum compatibility across
browsers. It has few requirements and is easy to configure and
install. SquirrelMail has all the functionality you would want from an email
client, including strong MIME support, address books, and folder manipulation.

<p>
This manual supports SquirrelMail 1.4.0 and up. The 1.2.x series has been
obsoleted, and is only referenced in the upgrading notes of this manual.

<sect1>Server requirements
<p>
There are only two requirements for SquirrelMail:
<itemize>
  <item>A web server with PHP installed. PHP needs to be at least 4.1.0.
  <item>Access to an IMAP server which supports IMAP 4 rev 1.
</itemize>

It doesn't really matter what OS or web server you use, as long as the
combination thereof supports PHP in a stable way. Read the instructions and
suggestions in the <url url="http://php.net/" name="PHP documentation"> to see
what they recommend.

If you're building your mail system from scratch, it might be a good idea to
install and test all components one by one. If you install everything at once
and things don't work, the troubleshoting will be more complex. If the web
server doesn't work there's not much point in trying to install PHP, for
instance. Make sure that everything is working before trying to install
SquirrelMail.

<sect2>Choosing an IMAP server
<p>
You don't actually have to run an IMAP server yourself, but you need to be able
to connect to one for SquirrelMail to work. Since IMAP is an open standard, all
IMAP products should be able to communicate with each other. SquirrelMail
requires that the server supports IMAP 4 rev 1, but that's the only requirement
there is.

Some IMAP servers support various extensions, which are developed as a
complement to IMAP. Those extensions aren't required by SquirrelMail, but many
of them are supported. It's recommended to have an IMAP server that supports
SORT and THREAD if possible. The SORT extension allows for server side sorting,
which is a lot more efficient than having to rely on PHP for sorting. This will
improve SquirrelMail's performance. If the server doesn't support the THREAD
extension, SquirrelMail can't show mail conversation as threads.

If possible, the IMAP server should support Unicode. Without it some
translations might be unable to use sorting and threading. Courier IMAP must be
compiled with the <tt/--enable-unicode/ option to have Unicode support.

SquirrelMail doesn't care about how the server stores the mails, but it's
generally a good idea not to have an IMAP server that store mails in the mailbox
(mbox) format. Mailbox performance is low when there are many mails in the same
folder and it doesn't allow both mails and subfolders at the same time in the
same folder.

Another good idea is to have an IMAP server that allows the use of virtual
accounts. Virtual users don't have to be system users, which usually is a good
thing. Again, this is not a SquirrelMail requirement, but something that you
might want to consider when choosing an IMAP server.

Some systems are delivered with an IMAP server, but if it doesn't measure up to
the suggestions above, you might want to replace it. There are plenty of IMAP
servers at the market, so it might be difficult to decide which one to choose.
It is also difficult to recommend something, since every organization has unique
demands. <url url="http://imap.org/" name="The IMAP Connection"> has a
searchable database of IMAP servers, as well as more information about IMAP, but
that list may not cover the entire market. There are also several sites offering
advice and opinions on this matter. Read them, but make your own decision since
the information at some of those sites might be outdated or biased. Remember
that some of the open source alternatives are well matured products that can
compete, and even surpass, the commercial servers.

<sect2>Configuring PHP
<p>
<itemize>
  <item>Without <url url="http://php.net/gettext" name="the PHP gettext
        extension"> you lose in performance.
  <item><url url="http://php.net/mbstring" name="The PHP mbstring extension"> is
        required for translations that use multibyte or character sets but
        ISO-8859-1. Without the PHP mbstring extension the interface will remain
        usable, but some internationalization features and fixes won't be
        enabled. It's a must if you want to read and write Japanese emails, and
        users who whish to do that must also set their language option to
        Japanese.
  <item><url url="http://php.net/xml" name="The PHP XML extension"> is required
        if the DIGEST-MD5 authentication is used.
</itemize>

<sect1>Optional server programs
<p>
<itemize>
  <item><url url="http://perl.org/" name="Perl">. SquirrelMail is shipped
        with some Perl scripts. One of the most useful is
        <tt>config/conf.pl</tt>, which will help you configure your SquirrelMail
        installation.
  <item>An SQL database supported by the PEAR DB library, and the PEAR DB
        library itself. See <ref id="db-backend" name="Using database backends">
        for more information.
  <item><url url="http://aspell.net/" name="Aspell"> or <url
        url="http://lasr.cs.ucla.edu/geoff/ispell.html" name="Ispell"> to be
        able to use the SquirrelSpell plugin.
</itemize>

These are not a must have, since SquirrelMail will function without them, but
they are adding to the experience so you might want to consider them.

<sect1>Client requirements
<p>
<itemize>
  <item>Cookies must be enabled in your browser.
  <item>It might be hard to use SquirrelMail on a display smaller then 15" and
        with less resolution than 1024 x 768, and some customizations are
        required to make it usable.
</itemize>

<sect1>Scalability
<p>
SquirrelMail is known to scale well for large installations with thousands of
users. It's recommended to have a lot of free memory available at the web
server. Another common problem with larger systems is the <url
url="http://squirrelmail.org/wiki/ConnectionsPerMinute" name="connections per
minute"> limitation. Suggested reading is <ref id="optimization"
name="Optimizing SquirrelMail">, <url
url="http://squirrelmail.org/wiki/SquirrelMailPerformance" name="SquirrelMail
performance">, and the <url
url="http://squirrelmail.org/wiki/BrowseProblemsByComplaint" name="speed section
in the wiki">.

An example of a large SquirrelMail installation (with peaks of 225 concurrent
IMAP connections) is described in the article <url
url="http://linuxjournal.com/article/7323" name="HEC Montréal: Deployment of a
Large-Scale Mail Installation"> from the May 2004 edition of Linux Journal.

<sect>Quick Start Guide
<p>
SquirrelMail can be downloaded from the SquirrelMail website or provided by your OS
packager. It is configured with the <tt/conf.pl/ utility, that is stored in
the <tt/config/ directory. You must configure SquirrelMail before using it.
SquirrelMail can be used by accessing it in web browser just like any other files
and scripts stored on your web server.

If you want to install SquirrelMail, check the chapters about SquirrelMail
installation.

<sect1>Directory layout
<p>
SquirrelMail files are split into subdirectories according to file type and
provided functions.

<tscreen><verb>
squirrelmail/
  class/
  config/
  contrib/
  data/
  doc/
  functions/
    decode/
    encode/
  help/
  images/
  locale/
  plugins/
  po/
  src/
  templates/
  themes/
    css/
</verb></tscreen>

<tt/class/ directory stores various classes used with mime messages, email
delivery, localizations and other interface functions.

<tt/config/ directory stores SquirrelMail configuration files and configuration
utility. <tt/conf.pl/ script is a perl based utility used to manage SquirrelMail
configuration. The <tt/config_default.php/ file stores default configuration
values. The <tt/config.php/ file stores current configuration. The file
<tt/config_local.php/ can store local site configuration overrides and
configuration options that are not supported by configuration utility.
<tt/default_pref/ stores <ref
id="default_pref" name="default user preferences"> that are used when a new
user logs in for the first time. <tt/default_pref/ file was stored in the
<tt/data/ directory before SquirrelMail 1.5.1.

The <tt/contrib/ directory stores files that provide extra features to SquirrelMail
package, but are not used directly in the webmail interface.

The <tt/data/ directory is default location for SquirrelMail users' preference
files. You should move that directory outside of web tree or make sure that it
can't be accessed by external users. This directory is not packaged anymore
since SquirrelMail 1.5.1.

The <tt/doc/ directory stores some documentation about SquirrelMail.

<tt/functions/ directory stores SquirrelMail function files. The <tt/decode/
subdirectory stores charset decoding functions that are used to read emails
encoded in different charsets. The <tt/encode/ directory stores charset encoding
functions that are used to convert emails to charset used in interface when
user replies or forwards email written in different charset.

Under <tt/help/ are SquirrelMail help files. Information from these files
is displayed when a user clicks on Help link in SquirrelMail menu line. Help files
use XML formating. They can be translated into different languages.

The <tt/images/ directory stores various image files that can be used in interface.

The <tt/locale/ directory stores SquirrelMail translations. A user can select
their preferred translation in SquirrelMail Display Options.

The <tt/plugins/ directory stores plugins that can be used to extend
SquirrelMail functionality. Activation of plugins is controlled
through the SquirrelMail configuration utility. Some plugins might
also use their own configuration files or functions provided by other
plugins. See README and INSTALL files in each plugin's directory.

The <tt/po/ directory stores scripts that are used to work with SquirrelMail
translation files. <tt/xgetpo/ script extracts translatable strings from
SquirrelMail script. <tt/mergepo/ script combines default strings with selected
translation. <tt/compilepo/ script compiles selected translation. These scripts
are usually used only by SquirrelMail translators.

The <tt/src/ directory stores scripts that are used when user accesses the
webmail interface.

The <tt/templates/ directory stores template files that can be used in
SquirrelMail 1.5.1 and later versions.

The <tt/themes/ directory stores SquirrelMail <ref id="themes"
name="colour themes">, and the <tt/css/ subdirectory stores style
sheet files available to end user.

<sect1>User data storage
<p>
SquirrelMail stores users' preferences and address books in simple text
files. The location of these files is set with the data directory setting
in the SquirrelMail configuration. SquirrelMail can also use a <ref id="db-backend"
name="database"> or some other storage facility (if the required backend
is provided by a plugin) for managing user preferences.

Users' preferences are stored in <tt/.pref/ files. Address books are stored in
<tt/.abook/ files. <tt/.sig/ and <tt/.si&lt;somenumber&gt;/ files store users'
signatures. Some plugins might use other files to store users' data.

When the number of files in the data directory becomes somewhat large, directory
access time can be affected. In such cases, the administrator can split
preference files into subdirectories by enabling directory hashing in
the SquirrelMail configuration.

<sect1>Configuration utility
<p>
SquirrelMail can be configured with <tt/conf.pl/, a Perl script that is stored in
the <tt>config/</tt> directory. You can start it by running the <tt>configure</tt>
script in the SquirrelMail base directory or by running the <tt>conf.pl</tt> script in
the <tt>config</tt> directory.

<tscreen><verb>
# cd /path/to/squirrelmail
# cd config
# ./conf.pl
</verb></tscreen>

This configuration utility provides menu based configuration options:
<tscreen><verb>
SquirrelMail Configuration : Read: config_default.php (1.4.0)
---------------------------------------------------------
Main Menu --
1.  Organization Preferences
2.  Server Settings
3.  Folder Defaults
4.  General Options
5.  Themes
6.  Address Books
7.  Message of the Day (MOTD)
8.  Plugins
9.  Database
10. Languages

D.  Set pre-defined settings for specific IMAP servers

C   Turn color on
S   Save data
Q   Quit

Command >>
</verb></tscreen>

Menu is controlled by entering numbers or letters that are listed on the left
side.

<sect1>The address book format<label id="addressbookformat">
<p>
By default SquirrelMail stores address books in files, one per address book,
named <tt/[user account name].abook/. These address book files are kept in the
data directory. Address books can also be stored in a <ref id="db-backend"
name="database"> or, if the required functions are provided by a plugin, another
storage facility. SquirrelMail can also be configured to lookup addresses in
LDAP directories, if the PHP installation contains LDAP support.

An address book file contains five fields, which are delimited by the vertical
line (|): the first field stores nicknames, short names that are used to
identify address book entries; the second field stores names; the third field
stores surnames; the forth field stores mail addresses; and the fifth field
stores additional information.

Additional address book fields and functions can be provided by the experimental
vcard address book format and some address book plugins. You can find list of
address book plugins at the SquirrelMail site.

Also see <ref id="addressbooks" name="personal and shared address books">.

<sect>Installing SquirrelMail
<sect1>Quick and Dirty install
<p>
In order to use SquirrelMail, you should take the following steps.

<sect2>Download all required software
<p>
You can find SquirrelMail package on <url url="http://squirrelmail.org"
name="SquirrelMail site">. PHP can be found on <url url="http://php.net"
name="PHP site">.

<sect2>Install webserver and PHP (at least 4.1.0).
<p>
SquirrelMail needs a webserver with PHP support. Check <url
url="http://php.net/manual/en/install.php" name="PHP install manual"> for
information about supported web servers and install procedures.

Some Linux and Unix distributions provide precompiled web server and php packages.

We recommend the following PHP settings:

<itemize>
    <item><tt/register_globals/ off - a dangerous setting, not needed. We do
          not release security advisories for issues only exploitable with this
          setting on. Note that you can easily enable it only for some legacy
          site that may need it and turn it off globally.
    <item><tt/magic_quotes_{runtime,gpc,sybase}/ off - SquirrelMail may work
          with any of these on, but if you experience stray backslashes in your
          mail or other strange behaviour, it may be advisable to turn them off.
    <item><tt/file_uploads/ on - needed if your users want to attach files to
          their mails.
    <item><tt/safe_mode/ on or off - safe_mode on is only a tiny bint more
          secure, in the SquirrelMail case. There may be some incompatibilities
          with some functionality (see <ref id="safe_mode" name="Safe mode">).
</itemize>

<sect2>Install IMAP server
<p>
It depends on used email system. Email server needs IMAP service that knows
used email system layout. If you use Unix with standard sendmail server, you
might have to install UW IMAP, Dovecot or other IMAP server, that can use email
stored in /var/spool/mail/ directory. If you use Windows, you might have to
enable IMAP service that is bundled with your email server. If your email server
does not support IMAP, you might have to find some other email server product.

<sect2>Unpack SquirrelMail package
<p>
Unpack the SquirrelMail package in a web-accessible location.

<sect2>Prepare data and attachment directories
<p>
Select a data-dir and attachment dir, outside the webtree (e.g. in /var).
The data-dir (for user prefs) should be owned by the user the webserver
runs as (e.g. www-data). The attachment dir (for uploading files as
attachments) should be file mode 0730 and in the same group as the
webserver.

If you use PHP with safe mode enabled, check chapter about safe mode.

<sect2>Configure SquirrelMail
<p>
Run <tt>config/conf.pl</tt> from the command line. Use the D option to load
predefined options for specific IMAP servers, and edit at least the
Server Settings and General Options (datadir).

<sect2>Check your SquirrelMail configuration
<p>
Browse to http://example.com/yourwebmaillocation/src/configtest.php
to test your configuration for common errors.

<sect2>Log into SquirrelMail
<p>
Browse to http://example.com/yourwebmaillocation/ to log in.

<sect1>Installing SquirrelMail on Unix and Linux systems
<p>
This chapter covers installation of SquirrelMail on generic Unix or Linux
system. It does not cover installation of operating system or tools required to
install web server or PHP.

Any version numbers used in examples are specific to the time when this
documentation is written. If current version numbers differ, make sure that you
are not using old, obsolete or vulnerable software.

Guide uses UW IMAP server as example. This IMAP server can be used in generic
email setup when incoming mail is stored in <tt>/var/spool/mail</tt>
directory. If you are planning to use webmail with big number of users or with
bigger mailboxes, consider using different IMAP server and redesign entire email
system.

<sect2>Download required software
<p>
You will need:
<itemize>
  <item>Apache - <url url="http://httpd.apache.org/download.cgi"
  name="http://httpd.apache.org/download.cgi">
  <item>PHP - <url url="http://php.net/downloads.php"
  name="http://php.net/downloads.php">
  <item>UW IMAP - <url url="http://www.washington.edu/imap/"
  name="http://www.washington.edu/imap/">
  <item>SquirrelMail - <url url="http://squirrelmail.org/download.php"
  name="http://squirrelmail.org/download.php">
</itemize>

<tscreen><verb>
# install -d /usr/local/src/downloads
# cd /usr/local/src/downloads
# wget http://some-apache-mirror-server/apache/httpd/httpd-2.0.54.tar.gz
# wget http://some-php-mirror-server/get/php-4.3.11.tar.bz2/from/this/mirror
# wget ftp://ftp.cac.washington.edu/mail/imap.tar.Z
# wget http://some-sourceforge-mirror/some-path/squirrelmail-1.4.5.tar.bz2
</verb></tscreen>

<sect2>Unpack and install apache
<p>
<tscreen><verb>
# cd /usr/local/src
# tar -xzvf /usr/local/src/downloads/httpd-2.0.54.tar.gz
# cd httpd-2.0.54
# ./configure --prefix=/usr/local/apache --enable-module=so
# make
# make install
</verb></tscreen>

<sect2>Unpack and install php
<p>
<tscreen><verb>
# cd /usr/local/src
# tar --bzip2 -xvf /usr/local/src/downloads/php-4.3.11.tar.bz2
# cd php-4.3.11
# ./configure --prefix=/usr/local/php \
> --with-apxs2=/usr/local/apache/bin/apxs
# make
# make install
</verb></tscreen>

If you configure PHP compilation with <tt/--disable-all/ option, you must add
<tt/--enable-session/ and  <tt/--with-pcre-regex/ options.

<sect2>Add PHP support to apache
<p>
<tscreen><verb>
&lt;IfModule mod_php4.c&gt;
  AddType application/x-httpd-php .php
&lt;/IfModule&gt;
</verb></tscreen>

<sect2>Restart apache and check if php is working
<p>
<tscreen><verb>
/usr/local/apache/bin/apachectl graceful
</verb></tscreen>

<tscreen><verb>
&lt;?php phpinfo(); ?&gt;
</verb></tscreen>

<sect2>Unpack and install imap server
<p>
Unpack UW IMAP archive.
<tscreen><verb>
# cd /usr/local/src
# tar -xzvf /usr/local/src/downloads/imap.tar.Z
</verb></tscreen>

Compile UW IMAP
<tscreen><verb>
cd /usr/local/src/imap-&lt;someversion&gt;
make port-name EXTRADRIVERS='' SSLTYPE=unix
</verb></tscreen>

Replace <tt>port-name</tt> with name that matches your system. Check Makefile
for possible values. If you haven't installed OpenSSL libraries and headers, use
<tt>SSLTYPE=none</tt> instead of <tt>SSLTYPE=unix</tt>.

Install IMAP server binary
<tscreen><verb>
strip imapd/imapd
install -d /usr/local/libexec/
cp imapd/imapd /usr/local/libexec/
</verb></tscreen>

Enable IMAP server in inetd.conf
<tscreen><verb>
imap2 stream tcp nowait root /usr/sbin/tcpd /usr/local/libexec/imapd
</verb></tscreen>

Restart inetd

<sect2>Prepare SquirrelMail directories
<p>
<tscreen><verb>
# mkdir /usr/local/squirrelmail
# cd /usr/local/squirrelmail
# mkdir data temp
# chgrp nogroup data temp
# chmod 0730 data temp
</verb></tscreen>

<sect2>Unpack SquirrelMail
<p>
<tscreen><verb>
# cd /usr/local/squirrelmail
# tar --bzip2 -xvf /usr/local/src/downloads/squirrelmail-1.4.5.tar.bz2
# mv squirrelmail-1.4.5 www
</verb></tscreen>

<sect2>Configure SquirrelMail
<p>
Start SquirrelMail configuration utility. Configure SquirrelMail with UW
preset. Set data and attachment directories.

<sect2>Configure access to SquirrelMail in Apache
<p>
Modify httpd.conf

<tscreen><verb>
Alias /squirrelmail /usr/local/squirrelmail/www
&lt;Directory /usr/local/squirrelmail/www&gt;
  Options Indexes
  AllowOverride none
  DirectoryIndex index.php
  Order allow,deny
  allow from all
&lt;/Directory&gt;
</verb></tscreen>

<sect2>Log into SquirrelMail
<p>
After you add alias to SquirrelMail in apache configuration and restart apache,
you should be able to access SquirrelMail by going to
<tt>http://your-server/squirrelmail</tt>.

<sect1>Installing SquirrelMail on Windows systems with Apache webserver
<p>
SquirrelMailInstallWin32Apache

<sect1>Installing SquirrelMail on Windows systems with IIS webserver
<p>
SquirrelMailInstallIIS

<sect1>Installing SquirrelMail on MaxOS X systems
<p>
MacInfoHere

<sect1>Prepackaged SquirrelMail installs
<p>
If your operating system distribution provides prepackaged SquirrelMail, it
might be a good idea to use that. The drawback is that you probably don't have
the latest and greatest version. But on the plus side: the whole installation
step is managed for you, it integrates better with the rest of your system
and you're provided with security updates automatically.

<p>
SquirrelMail provides RPM packages. There are two packaging flavors. Standard
package that can be used on RedHat 8.x or later. 7.x.noarch.rpm package is
designed for RedHat 7.x systems. Main difference between packages - standard
package contains standard Apache configuration file with /webmail/ alias in
<tt>/etc/httpd/conf.d</tt> and different package dependencies. There are other
SquirrelMail packages created by RedHat, Fedora, SuSE and other RPM
distributions.

Debian packages can be downloaded from <url
url="http://packages.debian.org/squirrelmail" name="the Debian website"> or you can
install them with your favorite Debian package manager. For example: <tt>apt-get
install squirrelmail</tt>. If you use Debian stable and SquirrelMail package is
a little bit outdated, you might be able to install newer SquirrelMail package
from testing or unstable. This is not guaranteed to work though.

FreeBSD includes two different SquirrelMail packages in their ports collection.

<sect>Upgrading SquirrelMail
<p>
This chapter talks about upgrading an existing SquirrelMail install.

<sect1>Backup old install
<p>
Make a backup of your current SquirrelMail directory. If you use "cp", be
sure to use the "-Rp" options. -R means recursive, and -p will save the
permissions in the directory.

In this example, we assume that your httpd document directory is
<tt>/home/httpd/html</tt>, that your SquirrelMail install is located at
<tt>/home/httpd/html/squirrelmail-1.0.6</tt>, and that your new SquirrelMail
version is 1.2.0. Substitute version numbers and names as required.

<verb>
$ cd /home/httpd/html
$ cp -Rp squirrelmail-1.0.6 squirrelmail-1.0.6.bak
</verb>

<sect1>Unpack new SquirrelMail
<p>
Make sure that you are in your httpd document directory (<tt>/home/httpd/html</tt>)
and then unpack the SquirrelMail archive (whatever the filename is):
<verb>
$ tar -zxvf squirrelmail-1.2.0.tar.gz
</verb>

<sect1>Copy important files from old install
<p>
The important files to copy are:
<itemize>
  <item>Preferences
  <item>Config details
  <item>Plugins
  <item>Themes (if you've edited or added any of them)
</itemize>

<sect2>Preferences
<p>
First, copy your preference data over to the new directory. Usually
this is ok, but if you are upgrading from anything less than 1.0.5, we
strongly suggest you let your users reset their preferences. There
were important security upgrades in 1.0.5 regarding preference files.
<verb>
$ cp squirrelmail-1.0.6.bak/data/* squirrelmail-1.2.0/data
</verb>

<sect2>Config details
<p>
If at all possible, start the configuration process from scratch. It is
much less prone to missing configuration options than copying your old
configuration. Ideally, you should just run conf.pl to reconfigure
SquirrelMail. If you decide to copy your old config.php over, we strongly
recommend that you run conf.pl to make sure things are correct and then save
the config file.
<verb>
$ cp squirrelmail-1.0.6.bak/config/config.php squirrelmail-1.2.0/config
</verb>

<sect2>Copy plugins
<p>
Like SquirrelMail, plugins are frequently updated for improvements, as well
as to make them compatible with new SquirrelMail releases. It is suggested
that you download new versions of your plugins at the same time you download
your SquirrelMail install, and that you install your plugins fresh (it's
easy, don't panic!).

You should not try replacing plugins that are already included in the SquirrelMail
package. Download latest versions of plugins that are not included in the new
SquirrelMail package or copy them from your older SquirrelMail install.

<sect2>Copy themes
<p>
TODO: this changes in 1.5.2

If you've created or modified themes, you should copy just those to the new
SquirrelMail themes directory. To just copy them all over to the new
SquirrelMail installation, you can run one command.
<verb>
$ cp -ui squirrelmail-1.0.6.bak/themes/* squirrelmail-1.2.0/themes/
</verb>

When <tt/-u/ flag is used, command copies only missing and newer files.
When <tt/-i/ flag is used, command will ask for confirmation before replacing
existing files.

If you want to see your theme in future SquirrelMail packages, send it to
SquirrelMail developers. They might add it to the themes in the standard
install!

<sect1>Change permissions
<p>
The web server must have write permission to the data directory. In this
example, we assume that user "nobody" and group "nobody" are the web server
as is often the case with Apache.
<verb>
  $ cd squirrelmail-1.2.0
  $ chown -R nobody:nobody data
</verb>

Check your webserver's configuration file. It might be using different
userid/groupid pair. Additionally, if "chown user:group" doesn't work, you can
use "chown user" and "chgrp group" instead. See the man pages for these commands
for more information.

If you are using SquirrelMail in setup with PHP <tt/safe_mode/ restrictions,
data and attachment directories should be owned by same user that owns other
SquirrelMail scripts. It must be writable by the web server group (see <ref
id="safe_mode" name="Safe mode">).

<sect1>Run conf.pl
<p>
Run config/conf.pl to see the new configuration options available with the
new version, as well as to verify that all of your old options are set
properly.

Always save your options, also if you haven't changed anything.
This will ensure that any problems with conf.pl that might have been solved
are effective to your installation.

If you want to make sure that your configuration contains all themes included in
new SquirrelMail package, go to theme options in configuration utility and
run theme detection command.

<sect1>Version specific notes
<sect2>Upgrade from version older than 1.2.2 to later version.
<p>
In order to provide better internationalization support, developers have changed
names used by translations. From 1.2.2 SquirrelMail uses language and country
codes in translation names. In most of cases upgraded SquirrelMail should work
correctly. Only Norwegian Nynorsk (no_NO_ny) translation might need fixes. If
your user preference files contain <tt/language=no_NO_ny/ lines, these lines
should be updated to <tt/language=nn_NO/.

<sect2>Upgrade from 1.2.x or older versions to 1.4.x or later.
<p>
Layout changes. Plugins can break.

<sect2>Upgrade from version older than 1.4.4 to later version.
<p>
Translations are removed in order to reduce package size. You must download
and install separate translation packages.

<sect2>Downgrade from 1.5.1 to older version.
<p>
Index Order options are not preserved.

SquirrelSpell user dictionaries are not preserved.

<sect1>Recheck new install
<p>
Login into new SquirrelMail install and check if everything is working.

<sect1>Replace old install.
<p>
Redirect your users to new SquirrelMail install. You can use Apache <url
url="http://httpd.apache.org/docs/mod/mod_alias.html#redirectperm"
name="RedirectPermanent"> directive or other redirection tools provided by your
webserver.

If you use SquirrelMail directory without version information, you can also
replace it with new SquirrelMail directory.
<verb>
$ mv /home/httpd/html/squirrelmail /home/httpd/html/squirrelmail.old
$ mv /home/httpd/html/squirrelmail.new /home/httpd/html/squirrelmail
</verb>

<sect1>DONE!
<p>
That should be all! The most important part is copying your users'
preference files back into the new data directory. This will insure that
your users will have their old preferences. Remember to do so with caution,
especially if you are upgrading from a version before 1.0.5 to version 1.0.5
or later.

<sect>Configuring SquirrelMail<label id="configuring">
<p>
Even though the size of this documentation might indicate otherwise,
SquirrelMail is quite easy to configure. On the other hand, mailsystems are
quite complicated for a beginner so a few configuration tips might be useful.

<sect1>Configuration files and tools
<p>
SquirrelMail configuration is file based. If you've installed SquirrelMail
directly from source you'll find the configuration file in
<tt>config/config.php</tt>, but if you're using a SquirrelMail package from your
OS distribution the actual configuration file may be located somewhere else
(such as <tt>/etc/</tt>) - usually with a symbolic link from
<tt>config/config.php</tt>. Read the documentation that came with the
distribution package to find out more about OS distribution specific details.
The rest of these instuctions assumes that you've installed SquirrelMail from
source.

There are three ways to change the SquirrelMail configuration file: using the
configuration tool, using the Administrator plugin, or editing the configuration
file manually. The first of these ways is the one recommended by the
SquirrelMail Project.

<sect2>The configuration tool
<p>
Included in the SquirrelMail distribution is a Perl script, located at
<tt>config/conf.pl</tt>, which helps when creating or editing the configuration
file.

The first thing to do when configuring from scratch is to choose an IMAP server
using "D. Set pre-defined settings for specific IMAP servers". This will change
SquirrelMail configuration to match a default installation of the IMAP server
of your choice.

The next step is to go through all the menu selections and set the configuration
options to the values most suitable for your installation. Each configuration
option is described in the tool to help you make the right choices.

Even if you don't have Perl accessible at the computer where SquirrelMail is
insalled, you can use <tt>config/conf.pl</tt> if you have access to a computer
with Perl installed. Just copy <tt>config/conf.pl</tt> to the computer with
Perl, use it to create a configuration file, and then upload the configuration
file to <tt>config/config.php</tt> in your SquirrelMail installation.

Note that some OS distributions have their own tools to configure SquirrelMail,
which you might use instead (Debian, Ubuntu, and other Debian derived
distributions have "squirrelmail-configure", which can be run even outside the
SquirrelMail installation directory). Read the documentation that came with the
distribution package to find out more about OS distribution specific details.

<sect2>The Administrator plugin
<p>
SquirrelMail also includes the Administrator plugin as part of the distribution.
Some administrators considers this to be a more user-friendly tool than the Perl
script. It can be used instead of <tt>config/conf.pl</tt>, but is less safe
since it requires the web server to have write access to the configuration file.
Read <tt>plugins/administrator/INSTALL</tt> for instructions on how to install
it and set up the administrator user.

Once the Administrator plugin is configured and enabled, the SquirrelMail
configuration can be changed using a web interface within SquirrelMail. Log in
as a user with assigned administrator privileges and click "Options >
Administration". The Configuration Administrator page will open, providing you
with options to configure SquirrelMail (for instance enabling and disabling
plugins). When done, click "Save" to update the configuration at the server.

Even though you can use the Administrator plugin in all cases where
documentation suggests <tt>config/conf.pl</tt>, there's one exception to the
rule: the first installation. Since the Administrator plugin only can be used
from within SquirrelMail, you have to configure SquirrelMail using the
configuration tool or manually the first time.

<sect2>Manual configuration
<p>
Since <tt>config/config.php</tt> is a PHP file, SquirrelMail can also be
configured manually with the editor of your choice. A sample configuration is
provided in <tt>config/config_default.php</tt>, so copy
<tt>config/config_default.php</tt> to <tt>config/config.php</tt> and then edit
<tt>config/config.php</tt> to match your installation. The configuration options
are documented within the file to help you make the right choices. Note that
manually configuring SquirrelMail needs you to follow the PHP syntax. Make sure
that there is no trailing <url url="http://squirrelmail.org/wiki/EndOfLine"
name="end of line character"> and save the configuration.

<sect1>Basic configuration
<p>
In order to use SquirrelMail you must create a configuration file. Default
configuration should adjusted to match your setup. Main things that should be
checked are:
<itemize>
  <item>Default domain (2. Server settings &gt; 1. Domain)
  <item>Addresses of IMAP and SMTP servers.
  <item>Type of IMAP server. See next chapter about <ref id="select-imap"
  name="selecting IMAP server">.
</itemize>

You might want to change:
<itemize>
  <item>Organization Preferences (1. Organization Preferences)
</itemize>

Read the chapter <ref id="customizing" name="Customizing SquirrelMail"> for more
tips on how to make your SquirrelMail installation blend with your site.

<sect1>Selecting IMAP server<label id="select-imap">
<p>
Some IMAP servers use specific IMAP folder layout or need some tweaks in IMAP
client's configuration. In order to set SquirrelMail according to your server's
requirements you might have to set more than 10 different SquirrelMail
options. SquirrelMail simplifies modification of these settings by providing
special configuration command. If you select D command in SquirrelMail
configuration utility, you will be asked to select your IMAP server and all
settings will be adjusted according to selected IMAP server.

For example, correct combination of SquirrelMail settings can hide INBOX prefix
in courier IMAP server. Value that is set in IMAP <tt/"Server software"/
configuration option can fix search issues in EIMS or hmailServer, provide
workarounds for some folder subscription errors in mercury32 IMAP server, but it
does not affect system folder names, folder prefix, delimiter and other specific
configuration options.

SquirrelMail provides configuration presets for Cyrus, UW, Courier, Exchange,
EIMS (Mac OS X), hmailServer, mercury32 and dovecot IMAP servers. See chapter
about <ref id="presets" name="Presets"> for more information about server
specific settings.

<sect1>Authentication
<p>
Next to plain text logins for IMAP and SMTP, SquirrelMail supports the CRAM-MD5
and DIGEST-MD5 authentication mechanisms. It is possible to use different
methods for both IMAP and SMTP. Unless the administrator changes the
authentication methods, SquirrelMail will default to the "classic" plain text
methods.

<sect2>POP before SMTP
<p>
Some SMTP servers require POP3 authentication before accepting messages to
external recipients. SquirrelMail supports POP before SMTP. You can
enable it in SMTP server settings <tt/"POP before SMTP"/ option. SquirrelMail
uses same username and password that was used for IMAP authentication.

<sect2>Using different username for SMTP relaying
<p>
If SMTP server uses different username and password for authentication,
since 1.5.1 version SquirrelMail can use one username and password for entire
SquirrelMail installation. They can be set in <tt>config/config_local.php</tt>
<tt/$smtp_sitewide_user/ and <tt/$smtp_sitewide_pass/ configuration variables.

If you use older SquirrelMail version and want to use single user/password
for SMTP authentication, you might have to install local SMTP server and set it
as smart relay. See SMTP server's documentation about email relaying through
other SMTP server.

<sect1>StartTLS, IMAPS, SSMTP
<p>
SquirrelMail is able to connect to IMAP and SMTP servers that use TLS.
Since 1.5.1 version SquirrelMail is able to connect to IMAP and SMTP
servers that use STARTTLS (which is different from TLS).

<sect2>TLS requirements
<p>
<itemize>
  <item>PHP 4.3.0 or higher
  <item>The server you wish to use TLS on must have a dedicated port listening
  for TLS connections.
  <item>If you use PHP 4.3.x, OpenSSL support must be compiled staticly. See
  PHP bug <url url="http://bugs.php.net/bug.php?id=29934" name="#29934">.
</itemize>

<sect2>STARTTLS requirements
<p>
<itemize>
  <item>SquirrelMail 1.5.1 or higher
  <item>PHP 5.1.0 or higher with stream_socket_enable_crypto() function support.
  <item>IMAP or SMTP server with STARTTLS extension support.
</itemize>

TLS can be enabled in SquirrelMail configuration utility, <tt>"Server settings"</tt>
section. If you want to use IMAP with TLS, you should select command that
updates IMAP settings, enable TLS in <tt>"Secure IMAP (TLS)"</tt> option and set
secure IMAP port in <tt>"IMAP Port"</tt> option. Secure IMAP servers use tcp 993
port by default. If you want to use SMTP with TLS, you should select command
that updates SMTP settings, enable TLS in <tt>"Secure SMTP (TLS)"</tt> option and
set secure SMTP port in <tt>"SMTP Port"</tt> option. Secure SMTP servers use tcp 465
port by default.

STARTTLS extensions are enabled by selecting use of them in <tt>"Secure IMAP
(TLS)"</tt> or <tt>"Secure SMTP (TLS)"</tt> selection menu. These extensions
work by enabling encryption on plain text service ports. IMAP and SMTP ports
should be set to standard plain text IMAP and SMTP ports.

Note: There is no point in using TLS if your IMAP server is localhost. You need
root to sniff the loopback interface, and if you don't trust root, or an attacker
already has root, the game is over. You've got a lot more to worry about beyond
having the loopback interface sniffed.

<sect1>Default user preferences<label id="default_pref">
<p>
If SquirrelMail is configured to use file-based preferences, default preferences
are stored in your data directory in a file called <tt/default_pref/. As you add
plugins to your SquirrelMail installation, you might want to configure some of
them on your own account and then propagate those settings to all of your users.
Or you may simply want to change the default theme, etc. This is what you need
to do to accomplish that.

<enum>
  <item>Log into your own account (or a test account) and get all your
        configuration set to what you'd like the defaults to be.
  <item>Open the preference file related to the account you used. It's in the
        data directory and looks something like <tt/username.pref/ or
        <tt/user@example.com.pref/, depending on what your usernames look like.
  <item>Find the relevant settings. Most plugin settings are identified by the
        plugin's name being the first thing on the line. Note that some plugins
        can have multiple setting lines.
  <item>Copy those settings into the <tt/default_pref/ file in the data
        directory. If you want to duplicate all settings, you can copy the
        entire file, but be careful that nothing with your name, mail address,
        or other personal items get copied.
</enum>

Note that the <tt/default_pref/ file works only for users that don't have an
existing preference file (i.e. new users which haven't logged in yet). If you
want to add preferences to existing user accounts, you should edit (manually or
by a script) their existing preference files. It's not recommended to delete the
preference files, since that will revert <em/all/ preferences edited by your
users, including such settings as their real names.

<sect2>An example script
<p>
TODO: Write a better script (in Perl) providing this functionality and include it the SquirrelMail distribution.

This is a simple shell solution to edit more than one user preference file at
once.

If you, for example, want mails to display as HTML by default and change the
font to a custom one by using CSS, create a file containing:

<tscreen><verb>
show_html_default=1
custom_css=sans-10.css
</verb></tscreen>

Save the file as <tt>/tmp/default.pref</tt>, change to the data directory, and
run the following command from the prompt:

<tscreen><verb>
for l in `ls *.pref`; do cat /tmp/default.pref >> $l; done
</verb></tscreen>

<sect2>Forced preferences
<p>
If you want to force some preference settings for all your users, it's possible
when using <url url="http://squirrelmail.org/plugin_view.php?id=220" name="the
Forced Preferences plugin">. It works regardless of if the users have set their
own preferences or not.

<sect2>Default database backend preferences
<p>
If you're using a database base backend, the default settings are stored in the
array <tt/$default/, in the beginning of the <tt/dbPrefs/ class in
<tt>functions/db_prefs.php</tt>.

TODO: Having to edit the SquirrelMail source is bad. It should be possible to use <tt/default_pref/ for database backends as well, but unfortunately that's currently not a SquirrelMail feature.

<sect1>Using database backends<label id="db-backend">
<p>
On sites with many users you might want to store your user data in a database
instead of in files. SquirrelMail can be configured to do this. Note, however,
that some SquirrelMail plugins are designed to use different files for users'
data storage and won't be able to use database to store users' data.

Methods for storing both personal address books and user preferences in a
database is included as a part of the distribution.

<sect2>Configuring PEAR DB
<p>
SquirrelMail needs the <url url="http://pear.php.net/package/DB" name="DB
database abstraction layer">, which is a part of the <url
url="http://pear.php.net/" name="PHP Extension and Application Repository
(PEAR)">, to provide database backends. Make sure that your database is <url
url="http://pear.php.net/manual/en/package.database.db.php" name="compatible
with PEAR DB">, that PEAR is installed, and that the directory containing PEAR
is in <url url="http://php.net/configuration" name="PHP's include path"> (PHP
configuration variable: <tt/include_path/).

Note that some systems include PEAR with PHP, have PEAR and PHP as separate
packages, or comes without a pre-packaged version of PEAR thus forcing you to
install it manually. Check your system documentation to find out the details.

<sect2>Creating the database
<p>
First you need to create a database and a database user with access to
<tt/SELECT/, <tt/INSERT/, <tt/UPDATE/, and <tt/DELETE/ in that database. For
MySQL you would normally do something like:

<tscreen><verb>
mysql> CREATE DATABASE squirrelmail;
mysql> GRANT select,insert,update,delete ON squirrelmail.*
       TO squirreluser@localhost IDENTIFIED BY 'sqpassword';
</verb></tscreen>

Note that MySQL changed its password handling in 4.1, so you might need to force
the password to be in the older form. See <url
url="http://dev.mysql.com/doc/refman/4.1/en/password-hashing.html" name ="the
MySQL 4.1 manual"> for more information.

<tscreen><verb> mysql> SET PASSWORD FOR 'squirreluser' =
OLD_PASSWORD('sqpassword'); </verb></tscreen>

<sect2>Constructing a data source name
<p>
Both the address books and the preferences need to be configured with a data
source name (DSN). The DSN should look something like
<tt>mysql://squirreluser:sqpassword@localhost/squirrelmail</tt> or
<tt>pgsql://squirreluser:sqpassword@localhost/squirrelmail</tt>. See the <url
url="http://pear.php.net/manual/en/package.database.db.php" name="PHP Pear DB
manual"> for more details about DSN syntax.

When including a sensitive password in your DSN, please make sure that you
tighten the permissions on <tt>config/config.php</tt> accordingly, so untrusted
users can't read it.

<sect2>Storing address books in the database
<p>
Create a table for the address books. The table structure should be similar to
this for MySQL:

<tscreen><verb>
CREATE TABLE address (
  owner varchar(128) DEFAULT '' NOT NULL,
  nickname varchar(16) DEFAULT '' NOT NULL,
  firstname varchar(128) DEFAULT '' NOT NULL,
  lastname varchar(128) DEFAULT '' NOT NULL,
  email varchar(128) DEFAULT '' NOT NULL,
  label varchar(255),
  PRIMARY KEY (owner,nickname),
  KEY firstname (firstname,lastname)
);
</verb></tscreen>

and similar to this for PostgreSQL:

<tscreen><verb>
CREATE TABLE "address" (
  "owner" varchar(128) NOT NULL,
  "nickname" varchar(16) NOT NULL,
  "firstname" varchar(128) NOT NULL,
  "lastname" varchar(128) NOT NULL,
  "email" varchar(128) NOT NULL,
  "label" varchar(255) NOT NULL,
  CONSTRAINT "address_pkey" PRIMARY KEY ("nickname", "owner")
);
CREATE UNIQUE INDEX "address_firstname_key" ON "address"
  ("firstname", "lastname");
</verb></tscreen>

Don't forget to configure SquirrelMail with the DSN and the table name. This can
be done using either the SquirrelMail configuration utility or via the
administration plugin.

The global address book uses same table format as the personal address books.
You can even use same table if you don't have a user named "global", but that's
not recommended.

<sect2>Storing preferences in the database
<p>
Create a table for the preferences. The table structure should be similar to
this for MySQL:

<tscreen><verb>
CREATE TABLE userprefs (
  user varchar(128) DEFAULT '' NOT NULL,
  prefkey varchar(64) DEFAULT '' NOT NULL,
  prefval BLOB DEFAULT '' NOT NULL,
  PRIMARY KEY (user,prefkey)
);
</verb></tscreen>

and for PostgreSQL:

<tscreen><verb>
-- Note: Change the SquirrelMail config variable $prefs_user_field in
--       "config/config.php" from the default "user" to "username" since "user"
--       is a reserved word in PostgreSQL.
CREATE TABLE "userprefs" (
   "username" varchar(128) NOT NULL,
   "prefkey" varchar(64) NOT NULL,
   "prefval" text,
   CONSTRAINT "userprefs_pkey" PRIMARY KEY ("prefkey", "username")
);
</verb></tscreen>

Note the difference in the table column definitions between the MySQL and the
PostgreSQL structures above: the first column in the MySQL command is "user" and
for PostgreSQL it is "username". The default <tt/config.php/ file is configured
for the MySQL case, so you'll get a syntax error if you try to use the above
statements literally and don't account for the different column name.

Don't forget to configure SquirrelMail with the DSN, the table name, and the
field names. This can be done using either the SquirrelMail configuration
utility or via the administration plugin.

<sect2>Primary keys
<p>
You <bf>must</bf> set primary keys correctly. If keys are not set correctly,
database entries might be duplicated when users change their preferences.

<sect2>Oversized field values
<p>
Database fields have size limits. Preference table example sets 128
character limit to owner field, 64 character limit to preference key
field and 64KB (database BLOB field size) limit to value field.

If interface tries to insert data without checking field limits, it
can cause data loss or database errors. Table information functions
provided by Pear DB libraries are not accurate and some database
backends don't support them. Since 1.5.1 SquirrelMail provides
configuration options that set allowed field sizes.

If you see oversized field errors in your error logs - check your
database structure. Issue can be solved by increasing database field
sizes.

If you want to get more debugging information - check setKey() function
in dbPrefs class. Class is stored in functions/db_prefs.php

<sect2>Converting files to database
<p>
A conversion tool called <tt/flat2sql.pl/ is included since SquirrelMail 1.5.1.
It's also possible to download the lastest version from the <url
url="http://squirrelmail.svn.sourceforge.net/viewvc/squirrelmail/trunk/squirrelmail/contrib/flat2sql.pl"
name="repository">. <tt/flat2sql.pl/ converts the existing files to a number of
SQL statements, that can be used to insert the data into the database.

<sect1>Using more than one IMAP server
<p>
SquirrelMail is designed to work with one IMAP server. If you want to use the same
SquirrelMail installation with multiple IMAP servers, you should be able to
implement this with Perdition mail proxy, or with the Vlogin or Multilogin plugins,
or write your own custom server mapping function. These tools allow users to
be transparently redirected to their correct mail servers.

<sect2>Perdition proxy
<p>
<url url="http://www.vergenet.net/linux/perdition/" name="Perdition"> is POP and
IMAP proxy server, that can redirect users to appropriate mail servers.

<sect2>Vlogin plugin
<p>
Found in the main SquirrelMail plugins repository, this plugin helps manage
and manipulate usernames given at login time, and allows the use of different
SquirrelMail settings (such as login page image, or IMAP server) for each
domain, each user, or each user group.

<sect2>Multilogin plugin
<p>
Found in the main SquirrelMail plugins repository, this plugin allows the
manual selection of login server on the login page.

<sect2>sqimap_get_user_server
<p>
SquirrelMail can use mapping by a user defined function
instead of IMAP server's address. If IMAP server's address is set to
<tt/map:some_function_name/, SquirrelMail functions should use provided username
as first function argument and replace  mapping with address returned by
function.

SquirrelMail provides example <tt>map_yp_alias</tt> function that uses ypmatch
program to get IMAP servers from yellowpages (NIS).

This feature is experimental. If some code does not take into account use of
mapping in imap server's address configuration, it might be broken.

<sect>Optimizing SquirrelMail<label id="optimization">
<p>
This chapter should explain what can help in speeding up your SquirrelMail
installation and improve its performance.

<sect1>Examining the whole chain
<p>
SquirrelMail is far from a stand alone product. The performance of a webmail system
depends on a lot of factors. It makes sense to look at each of these factors. You
should think about the following:
<itemize>
<item>Webserver. There's a lot of documentation about tuning Apache for example.
<item>PHP. Using PHP as a module is a lot faster than the CGI version.
<item>IMAP server. This starts with the choice of software. Different servers can have
radical performance differences.
<item>Authentication backend. Some backends have slow responses. Caching solutions
are available.
<item>Mail storage backend (mbox, maildir, database).
<item>SquirrelMail itself.
</itemize>

<sect1>PHP extensions
<p>
You can install or enable some PHP extensions which will make SquirrelMail
functionality run faster. SquirrelMail uses gettext functions for translations.
If PHP gettext extension is not present, the interface switches to slower
internal gettext implementation.

If you use CRAM-MD5 or DIGEST-MD5 authentication methods, SquirrelMail can use
PHP mhash functions. If PHP mhash extension is not present, interface uses own
hmac_md5 implementation.

In some cases SquirrelMail can take advantage of PHP recode or iconv
functions. These functions can be used to speedup decoding of CJK charsets.

<sect1>IMAP server extensions
<sect2>Sorting
<p>
If the IMAP server supports the IMAP extension SORT (most mainstream servers do)
enable this feature in SquirrelMail's configuration. In general, always enable
this option if your server supports it since it's way faster than sorting in
SquirrelMail, and may prevent problems for end users with very large mailboxes.
When not using server-side sorting, these end users may get an empty page upon
viewing the large mailbox, because the PHP sorting times out. It'll vary by
machine speed, but it has been reported that when viewing a folder containing
circa 17,000 mails, the initial viewing delays can decrease from around 35
seconds to 4 seconds.

The only case when server-side sorting causes problems in SquirrelMail is when
the IMAP server doesn't support the character set used by the translation
selected in SquirrelMail. SquirrelMail can use more than 15 character sets in
server-side sorting and threading commands. Courier IMAP server only supports
them when compiled with the <tt/--enable-unicode/ option. Cyrus IMAP (v.2.2.12)
doesn't support some of the multibyte character sets used by SquirrelMail.

<sect2>Threading
<p>
SquirrelMail also allows using server-side threading if the IMAP server supports
it. This option offers the end users to view the message list in a thread view.
Threaded sorting requires more system resources and you should enable it only if
you want to provide such an option to end users.

<sect2>Enabling the extensions
<p>
To find out if the IMAP server supports server-side sorting and threading,
telnet to it and ask:

<tscreen><verb>
> telnet imapserver.example.com imap
* OK

1 capability
* CAPABILITY IMAP4rev1 UIDPLUS CHILDREN NAMESPACE THREAD=ORDEREDSUBJECT THREAD=REFERENCES SORT QUOTA IDLE AUTH=PLAIN STARTTLS
1 OK CAPABILITY completed
</verb></tscreen>

The SORT and THREAD capabilities indicates that this server supports these
extensions. Next step is to configure SquirrelMail to use them.

Using <tt>config/conf.pl</tt>:

<tscreen><verb>
4. General Options
    10. Allow server thread sort:   false
    11. Allow server-side sorting:  false
</verb></tscreen>

Editing <tt>config/config.php</tt>:

<tscreen><verb>
$allow_thread_sort = false;
$allow_server_sort = false;
</verb></tscreen>

<sect2>Sorting and threading since 1.5.1
<p>
SquirrelMail 1.5.1 introduces some changes when it comes to sorting and
threading. Sorting and threading is used by default, if the IMAP server supports
it (according to the IMAP server's CAPABILITY response). It is, however,
possible to manually override that, thus disabling them, in SquirrelMail's
configuration.

Using <tt>config/conf.pl</tt>:

<tscreen><verb>
4. General Options
    10. Disable server thread sort:   false
    11. Disable server-side sorting:  false
</verb></tscreen>

Editing <tt>config/config.php</tt>:

<tscreen><verb>
$disable_thread_sort = false;
$disable_server_sort = false;
</verb></tscreen>

Even with server-side sorting disabled, PHP sorting is faster thanks to the
rewritten sorting code.

<sect1>Mailbox format
<p>
Default Unix mailbox format is slower than other formats and can increase server
loads when used with bigger mail folders. If you use UW IMAP server, you should
try switching to mbx mailbox format. Maildir mailboxes have higher bottlenecks
than formats that store entire mail folder in one file.

<sect1>Use server side filtering
<p>
Mail filtering, i.e. deleting mails or putting them in selected folders based on
criteria, isn't a must have mail system feature, but it sure is one of those
nice to have features that the end users might require.

To avoid negative performance impact as much as possible, systems providing mail
filtering should do so by using a server side application. The SquirrelMail
package includes the Filter plugin, but it should be the last resort when other
means of filtering can't be provided. The plugin is implemented in PHP and works
only when users actively log in to their mail accounts, making the display of
the folders slower (typically when logging in, and especially for accounts with
a large amount of mail) or, at worst, produce errors thus preventing the use of
some accounts completely. Server side filtering, performed by applications such
as <url url="http://www.procmail.org/" name="Procmail">, <url
url="http://www.courier-mta.org/maildrop/" name="Maildrop">, or any application
using <url url="http://rfc.net/rfc3028.html" name="Sieve">; provide more
options, work even when users do not actively log into their accounts, and are
much faster and more efficient.

SquirrelMail frontends for server side filtering applications are found at the
<url url="http://squirrelmail.org/plugins_category.php?category_id=3"
name="Filters &amp; Spam"> section of the plugin pages.

<sect1>Use an IMAP proxy
<p>
A caching IMAP proxy server can vastly improve SquirrelMail performance by
cutting down on the number of times you have to create a new connection to the
IMAP server. It keeps server connections alive for reuse avoiding a new IMAP
connection for each SquirrelMail transaction. Install the proxy at the web
server, configure SquirrelMail to connect to the proxy (localhost), and
configure the proxy to connect to the IMAP server. A side benefit is your logs
aren't full of IMAP logins.

<url url="http://www.imapproxy.org/" name="IMAP Proxy"> is a caching IMAP proxy
server known to be working well in various SquirrelMail installations. The
latest version allows log levels to be configured at runtime from the
configuration file. It's free, open source software and runs on various
platforms.

<sect1>PHP cache
<p>
A PHP cache is a tool that might speed up PHP scripts. The general idea is to
check if a PHP script is modified since it was cached, and use the cached copy
if it wasn't. If the script is new or modifed, it's compiled and cached. The
benefit is that using precomplied, cached copies of the script are quicker then
compiling the script every time it's requested. Here are some examples of
products to try:

<url url="http://pecl.php.net/package/APC" name="Alternative PHP Cache"> is a
"free, open, and robust framework for caching and optimizing PHP intermediate
code". It's released under the PHP License.

<url url="http://eaccelerator.net/" name="eAccelerator"> is a fork of the old,
discontinued <url url="http://sourceforge.net/projects/turck-mmcache"
name="Turck MMCache for PHP"> project. It's described as a "free open-source
PHP accelerator, optimizer, encoder and dynamic content cache", and is released
under the GNU LGPL.

<url url="http://www.php-accelerator.co.uk/" name="PHP Accelerator"> is an
"easily installed PHP Zend engine extension that provides a PHP cache, and is
capable of delivering a substantial acceleration of PHP scripts without
requiring any script changes, loss of dynamic content, or other application
compromises". There is no official license for PHPA, and it's free for use.

<url url="http://www.zend.com/store/products/zend-optimizer.php" name="Zend
Optimizer"> is a "free application that runs the files encoded by the Zend
Guard, while enhancing the performance of PHP applications." It's released under
the Zend License Agreement.

<sect1>Decreasing the bandwidth
<p>
Sometimes the speed of the server is perceived to be terribly slow, but it is
the cause of the modem speed or bandwidth at some intermediate server. To cut
down on the amount of traffic generated from the server, you could compress web
pages or condense them by removing excess garbage. Keep in mind that this will
put a little more load on your server, but it is practically nothing when
compared to your IMAP server and SquirrelMail.

<sect2>Compression
<p>
These solutions only compress the output to clients that support it, so you
don't need to worry about corrupting data to some older browsers by enabling any
of the options listed below. They are listed in order of preference.

Only implement one or else you might get some weird problems.

<itemize>
  <item>Configure the web server to compress the web pages (and maybe images).
        The module <tt/mod_deflate/ is part of Apache since 2.0 and there's also
        a third party module for Apache called <tt><url
        url="http://schroepl.net/projekte/mod_gzip/" name="mod_gzip"></tt>.
  <item>PHP can also compress all PHP pages sent out by setting the
        <tt/output_handler/ to <tt/ob_gzhandler/, or enable
        <tt/zlib.output_compression/ in <tt/php.ini/.
  <item>SquirrelMail has the <url
        url="http://squirrelmail.org/plugin_view.php?id=19" name="Gzip
        Compressed Output"> plugin that can compress certain pages, but won't
        compress much. It does help, but one of the others is suggested instead.
</itemize>

<sect2>Condensation
<p>
This refers to cleaning the HTML and removing unnecessary garbage in an effort
to send as little to the client without actually changing the structure of the
web page. Usually white space (extra spaces and new lines) are condensed into
one, comments are removed, and sometimes HTML tags will be changed to be more
efficient.

Unfortunately the SquirrelMail Project Team doesn't know of a semi-standard
module or PHP extension that does this, but we'd like to be informed if you find
one.

<sect>Customizing SquirrelMail<label id="customizing">
<p>
SquirrelMail can be customized in a couple of ways, both to fit your system
better and by changing some of the visual appearance. This chapter provides
information about how to that.

<sect1>Plugins
<sect2>What is a plugin?
<p>
SquirrelMail is a modular system, wherein its functionality can be extended with
extra features provided by various plugins. The plugins may be downloaded from
various sources, one of them being <url
url="http://squirrelmail.org/plugins.php" name="the SquirrelMail Project's
official plugin page">.

Read the plugin's documentation and requirements to find out if this is a plugin
that might be used in your setup. Sometimes you might need to uncompress the
plugin package to be able to read the full documentation about it.

Plugins available to SquirrelMail must be stored in the SquirrelMail plugins
directory. Each plugin uses its own subdirectory therein.

<sect2>Installing a plugin
<p>
Installation of a new plugin is done it in a number of steps described below.

<enum>
  <item>Uncompressing
  <item>Configurating
  <item>Enabling
  <item>Testing
</enum>

<sect3>Uncompressing a plugin
<p>
Download the plugin package, save it in <tt>/[path to
SquirrelMail]/plugins/</tt> and uncompress it. This should create a new
directory with the uncompressed plugin in it. Obviously, you have to substitute
<tt/[path to SquirrelMail]/ with the path used at your system. Here's an
example:

<tscreen><verb>
cd /var/www/squirrelmail/plugins/
tar -xzvf newplugin-1.0.tar.gz
</verb></tscreen>

<sect3>Configuring a plugin
<p>
Every plugin should come with a README and/or INSTALL file (and maybe some other
documentation as well) which should always be read before enabling the plugin.
There might be some extra setup steps needed, such as configuring or patching,
that are specific to that plugin or your system, and those steps are described
there. Any dependencies, such as special libraries, should also be listed in the
plugin documentation. However, many plugins require no additional configuration.

Some plugins depend on <url url="http://squirrelmail.org/plugin_view.php?id=152"
name="the Compatibility plugin">, but it might be important which version of the
Compatibility plugin is used. <url
url="http://squirrelmail.org/wiki/CompatibilityDependencies" name="The wiki">
provides more information as a complement to the plugin's documentation.

<sect3>Enabling or disabling a plugin
<p>
There are two ways to enable or disable a plugin: the configuration script tool,
or to edit the configuration manually. Using the configuration script is
recommended.

<sect4>Using the configuration script
<p>
Go to the main SquirrelMail directory and run the configuration script, by
executing;

<tscreen><verb>
cd /[path to SquirrelMail]/
config/conf.pl
</verb></tscreen>

Select the menu option "8. Plugins". This option displays all plugins present in
the directory <tt>plugins/</tt> divided in two categories: installed and
available. The installed category lists plugins that are currently enabled, and
the available category lists plugins that are not currently enabled but are
available for use. If you correctly uncompressed the plugin in the right place,
it should be listed among the available plugins.

<tscreen><verb>
SquirrelMail Configuration : Read: config.php (1.4.0)
---------------------------------------------------------
Plugins
  Installed Plugins
    1. abook_take
    2. delete_move_next
    3. listcommands
    4. message_details

  Available Plugins:
    5. administrator
    6. bug_report
    7. calendar
    8. filters
    9. fortune
    10. info
    11. mail_fetch
    12. newmail
    13. newplugin
    14. sent_subfolders
    15. spamcop
    16. squirrelspell
    17. translate

R   Return to Main Menu
C   Turn color on
S   Save data
Q   Quit

Command &gt;&gt;
</verb></tscreen>

Each plugin has a number written next to its name. If you enter that number on
the command line, the corresponding plugin is enabled or disabled. Don.t forget
to save your changes by entering "S" at the command line.

<sect4>Manually editing the configuration file
<p>
Find the SquirrelMail configuration file <tt/config.php/ file (usually located in
<tt>/[path to SquirrelMail]/config/</tt>. Edit it using your favorite text
editor, and add a line similar to this:

<tscreen><verb>
$plugins[0] = 'newplugin';
</verb></tscreen>

The example above will add "newplugin" as the first plugin (index zero). There
might already be other plugins installed, and if that is the case, make sure to
change the zero to the first available plugin index number, since two plugins
aren't allowed to share index number.

Since SquirrelMail 1.5.2 you also need to edit the file <tt/plugin_hooks.php/
(usually located in <tt>/[path to SquirrelMail]/config/</tt>. Inside of that
file, you must add all of the plugin hook registration points that are listed in
the plugin's <tt/setup.php/ file, inside the
<tt/squirrelmail_plugin_init_[plugin name]()/ function.

Make sure that there is no trailing <url
url="http://squirrelmail.org/wiki/EndOfLine" name="end of line character"> and
save the configuration.

<sect3>Testing a plugin
<p>
Test the plugin to make sure that it works. This step is almost always
successful, but if it isn't you may need to get support. Consult the plugin
documentation to find out how to get the support, since it might vary depending
on the plugin. It's usually a good idea to install, enable, and test one plugin
at a time, since some plugins might not go well with the used system setup or
other installed plugins.

<sect3>Creating a plugin
<p>
For information about how to code plugins, see the <url
url="http://squirrelmail.org/docs/devel/devel.html" name="the SquirrelMail
Developer's Manual">.

<sect1>Site customizations
<p>
There are configuration options dealing with customizing SquirrelMail to your
site available in the configuration tool under "1. Organization Preferences".
For those who prefer manual configuration the same configuration options are
available under the <tt>/*** Organization preferences ***/</tt> headline.

There's also information about embedding the login form in other web pages to be
found at <url url="http://squirrelmail.org/wiki/EmbeddedSquirrelMailLogin"
name="the wiki page about embedding the login form">.

TODO: Custom login page. Site control with the vlogin plugin.

<sect1>Themes and Styles<label id="themes">
<p>
TODO: This section has to rewritten with the changes, such as templates, in 1.5.2 when that version is released.

SquirrelMail users are able to customize the look of the interface by selecting
a custom theme and the font style. The configuration options dealing with
customizing SquirrelMail themes and styles available in the configuration tool
under "5. Themes". For those who prefer manual configuration the same
configuration options are available under <tt>* Themes</tt>.

SquirrelMail themes define interface colors. Each theme is a set of 17 or more
colors.

Creating your own theme is very simple. Just go into the <tt>themes/</tt>
directory and create a file called <tt/yourtheme_theme.php/. You then need to
create an array with 17 elements (0-16). Below is a theme template followed by a
description of what the different entries are for. Replace each "xxxxxx" with
whatever HTML hex color code that you want for that element.

<tscreen><verb>
<?php

/**
 * My Theme
 *
 * Author: My name
 * Date:   Today's date
 *
 * Optional description
 */

global $color;
$color[0]   = '#xxxxxx';
$color[1]   = '#xxxxxx';
$color[2]   = '#xxxxxx';
$color[3]   = '#xxxxxx';
$color[4]   = '#xxxxxx';
$color[5]   = '#xxxxxx';
$color[6]   = '#xxxxxx';
$color[7]   = '#xxxxxx';
$color[8]   = '#xxxxxx';
$color[9]   = '#xxxxxx';
$color[10]  = '#xxxxxx';
$color[11]  = '#xxxxxx';
$color[12]  = '#xxxxxx';
$color[13]  = '#xxxxxx';
$color[14]  = '#xxxxxx';
$color[15]  = '#xxxxxx';
$color[16]  = '#xxxxxx';
</verb></tscreen>

Here are descriptions of what the different entries in the array are colors of.
The letter after the number denotes "B" for background and "F" for foreground
colors.

<tabular ca="rll">
<bf/No./|<bf>B/F</bf>|<bf/Description/@
0|B|Title bar at the top of the page header.@
1|F|Error messages border, usually red.@
2|F|Error messages, usually red.@
3|B|Left folder list background color.@
4|B|Normal background color.@
5|B|Header of the message index (From, Date, Subject).@
6|F|Normal text on the left folder list.@
7|F|Links in the right frame.@
8|F|Normal text (usually black).@
9|B|Darker version of #0.@
10|B|Darker version of #9.@
11|F|Special folders color (Inbox, Trash, Sent).@
12|B|Alternate color for message list (alters between #4 and this one).@
13|F|Color for single-quoted text ("> text") when reading (default: <tt/#800000/).@
14|F|Color for text with more than one quote (default: <tt/#ff0000/).@
15|F|Non-selectable folders in the left frame (default: <tt/$color[6]/).@
16|B|Highlight color (since SquirrelMail 1.5.1, default: <tt/$color[2]/). Note that even though color 16 is in the templates since SquirrelMail 1.4.6 it's not actually used in the 1.4 branch.
</tabular>

Next all you have to do is run SquirrelMail configuration utility and add the
theme to the list of themes available to you.

It's also possible to provide a style sheet to be included on every page. That's
useful for specifying a site-wide font or other characteristics. More
information about this is available at <url
url="http://squirrelmail.org/wiki/StyleSheets" name="the wiki page about style
sheets">.

<sect1>Internationalization
<p>
SquirrelMail interface can be used with different languages. Default language
can be set in SquirrelMail configuration utility. User can select other language
in Options &gt; Display Preferences. In SquirrelMail 1.4.5/1.5.1 or later
administrator can set default language to empty string. Then interface will try
to detect preferred translation from browser's preferred language setting.

SquirrelMail implements translations with gettext functions. Interface can use
PHP gettext extension or internal gettext implementation. If PHP gettext
extension is used, it might require special webserver setup. On Linux gettext
functions work only when appropriate system locales are available. On BSD you
should be able to set LC_ALL environment variable in PHP script. There are some
differences between GNU Gettext and Solaris Gettext implementations.

<sect2>Supported character sets
<p>
SquirrelMail displays interface in character set that depends on selected
translation. If SquirrelMail has to display email written in other charset,
interface uses special decoding functions that convert email to html codes that
can display foreign symbols in selected character set.

Stock SquirrelMail installation supports following charset decoding
functions:
<itemize>
  <item>cp1250 (windows-1250) - since 1.4.3 and 1.5.0
  <item>cp1251 (windows-1251)
  <item>cp1252 (windows-1252) - since 1.4.3 and 1.5.0
  <item>cp1253 (windows-1253)
  <item>cp1254 (windows-1254)
  <item>cp1255 (windows-1255) - since 1.4.3 and 1.5.0
  <item>cp1256 (windows-1256) - since 1.4.3 and 1.5.0
  <item>cp1257 (windows-1257)
  <item>cp1258 (windows-1258) - since 1.4.3 and 1.5.0
  <item>cp855 (ibm855) - since 1.4.3 and 1.5.0
  <item>cp866 (ibm866) - since 1.4.3 and 1.5.0
  <item>iso-8859-1
  <item>iso-8859-2
  <item>iso-8859-3 - since 1.4.3 and 1.5.0
  <item>iso-8859-4
  <item>iso-8859-5
  <item>iso-8859-6 - since 1.4.3 and 1.5.0
  <item>iso-8859-7
  <item>iso-8859-8 - since 1.4.3 and 1.5.0
  <item>iso-8859-9
  <item>iso-8859-10 - since 1.4.3 and 1.5.0
  <item>iso-8859-11 - since 1.4.3 and 1.5.0
  <item>iso-8859-13
  <item>iso-8859-14 - since 1.4.3 and 1.5.0
  <item>iso-8859-15
  <item>iso-8859-16 - since 1.4.3 and 1.5.0
  <item>iso-ir-111 - since 1.4.3 and 1.5.0
  <item>koi8-r
  <item>koi8-u - since 1.4.1 and 1.5.0
  <item>ns-4551_1
  <item>tis-620 - since 1.4.3 and 1.5.0
  <item>us-ascii - since 1.4.4
  <item>utf-8 - two and three byte characters are supported since 1.4.0.
  Four byte characters are supported since 1.4.4 and 1.5.1. Five and six
  byte character decoding is available since 1.4.4 and 1.5.1, but not enabled
  by default.
</itemize>

Decoding functions might break in some SquirrelMail versions, if PHP
mbstring.func_overload setting is enabled.

big-5, euc-kr and gb2312 characters can be displayed by Chinese and Korean
translations that use those character sets. Japanese translation can display
iso-2022-jp, euc-jp and shiftjis character sets. Other Eastern characters will
be displayed correctly only when character codes match big-5, euc-kr or gb2312
character sets.

Other character sets can be decoded with extra decoding library functions. These
functions are loaded automatically since 1.4.4 and 1.5.1, if appropriate files
are present in functions/decode directory.

<sect2>Message composition
<p>
SquirrelMail can create emails that use character set defined in user's
translation. Composed email must use symbols that are supported by selected
charset. If unsupported symbols are used, browser might use different character
set or html entities instead of entered characters.

Different character set can be used only with US English
translation. Administrator can set that character set in SquirrelMail
1.4.5/1.5.1 configuration utility. Users can also select different character
set, if the Custom Charset plugin is installed.

<sect1>Personal and shared address books<label id="addressbooks">
<p>
SquirrelMail supports multiple address book backends. Backends can be
configured to provide address books that store entries visible to one user
or to group of users or to all users that use same SquirrelMail installation.

SquirrelMail supports own flat file format, database supported by PHP Pear
DB libraries and LDAP.

LDAP address books are readonly and listing of addresses is available only
when users search for address.

Global address book is address book that can be shared between users. Global
address books can be configured in SquirrelMail since 1.4.4 version. Before
than admin had to modify functions/addressbook.php file. There is a typo in
1.4.4 code and if you want to have writeable global address
books, you should apply patch or use newer SquirrelMail version. See
<url url="http://squirrelmail.org/wiki/KnownBugs"
name="http://squirrelmail.org/wiki/KnownBugs">

If admin wants to use different backend for address book storage (IMSP,
personal LDAP address books, sticky notes attached to server),
SquirrelMail 1.4.5 and 1.5.1 provide hooks that allow plugins to attach their
own functions during address book initiation and admin needs only a plugin that
can interact with used data storage system. Older SquirrelMail versions
need two extra hooks in functions/addressbook.php. Current backend implementation
is limited to standard SquirrelMail address book format.

<sect2>How to use shared file based address book in SquirrelMail.
<p>
1. Get SquirrelMail 1.4.4, 1.5.1, or any later version.

2. If you want to use a writable address book in 1.4.4, get <url
url="http://squirrelmail.cvs.sourceforge.net/squirrelmail/squirrelmail/src/addressbook.php?r1=1.58.2.16&amp;r2=1.58.2.17"
name="a patch that fixes the address book form">.

3. Create address book file. SquirrelMail address book uses CSV format
with | symbol as delimiter.

first field is nickname
second field - name
third field - surname
forth field - email
fifth field - additional information

for example:

<tscreen><verb>
test|Testname|Testsurname|test@example.org|testinfo
</verb></tscreen>

4. If you want writable address book, file must be writable by webserver
user.

5. After you have created address book file, go to SquirrelMail configuration
utility, select 6. Address Books option and configure address book in 3.
Global file address book.

If you enter only address book file name, system assumes that address book
is in data directory. For example: <tt/global_abook/. If you use data directory
to store global address book, remember that personal address books use
<tt/.abook/ suffix. You should not use global address book file with same
suffix, unless you understand what you are doing.

If you enter full path, system uses full path. For example:
<tt>/var/lib/squirrelmail/global_abook</tt>

If your configuration option contains slashes, but does not look like full
path, system assumes path relative to SquirrelMail top directory.

If you want to use global file based address book in older SquirrelMail
versions, take a look at <tt>functions/addressbook.php file</tt>. It contains some
comments that explain how to do that without configuration utility.

Also see <ref id="addressbookformat" name="the address book format">.

<sect>Security
<p>
This chapter should discuss some security aspects of your SquirrelMail
installation.

Used terms:
<descrip>
  <tag/TLS - Transport Layer Security/
  Transport Layer Security is cryptographic protocol which provides secure
  communications on the Internet. It is the successor to SSL v.3.0 protocol. The
  term "SSL" often applies to both TLS and SSL protocols. The differences
  between this protocol and SSL 3.0 are not dramatic, but they are significant
  enough that TLS 1.0 and SSL 3.0 do not interoperate (although TLS 1.0 does
  incorporate a mechanism by which a TLS implementation can back down to SSL
  3.0). TLS v.1.0 protocol is refined in RFC 2246.

  <tag/SSL - Secure Sockets Layer/
  Secure Sockets Layer is cryptographic protocol which provides secure
  communications on the Internet. Protocol runs on layers beneath application
  protocols such as HTTP, SMTP and NNTP and above the TCP transport protocol,
  which forms part of the TCP/IP protocol suite. SSL v.3.0 protocol is refined
  by Netscape Corporation. <url url="http://wp.netscape.com/eng/ssl3/"
  name="http://wp.netscape.com/eng/ssl3/">

  <tag/STARTTLS/
  STARTTLS is special extension to standard plain text communication
  protocols. STARTTLS extensions offer a way to upgrade to TLS from a plaintext
  connection, rather than use a separate port for encrypted communications. SMTP
  STARTTLS extension is refined in RFC 2487. IMAP STARTTLS extension is refined
  in RFC 2595. The Internet Engineering Task Force recommends use of STARTTLS
  instead of a separate port for encrypted communications.
</descrip>

<sect1>Main SquirrelMail attack vectors
<p>
SquirrelMail is webmail interface written in PHP. Webmail interface could be
attacked through specifically crafted emails, interface programming mistakes
and user information hijacking. It can be used to send unsolicited email
messages from hijacked or abused email account.

In order to prevent crafted email exploits SquirrelMail uses special <url
 url="http://linux.duke.edu/projects/mini/htmlfilter/" name="htmlfilter">
library to filter dangerous html code and prevents loading of remote web
data. Htmlfilter code needs constant updates because crackers discover various
design problems in web browser and can try exploiting them in webmail
interfaces. If you want to be safe, make sure that you are running latest
secured web browser version and SquirrelMail scripts are not outdated.

Interface programming mistakes usually can exploited only by authenticated
user. They can lead to hijacking of other users' data or executing scripts with
webserver user privileges. SquirrelMail developers are trying to prevent such
exploits. If you find some way to security of SquirrelMail scripts, inform about
it SquirrelMail developers.

User's login information can be hijacked in communications between IMAP and web
servers, session and data storage facilities on web server, communications
between web server and web browser and with tracking tools on user's machine.

In order to track emails sent through webmail interface SquirrelMail automatically
adds own Received: headers with sender's IP address, detected information about
used proxies and used username. This information can be hidden by encrypting it.
Webmail administrators can completely remove username and address information by
editing <tt>class/deliver/Deliver.class.php</tt> file. You should not remove
user information from email headers unless you make sure that you can retrieve
information with other tools or user forging is not possible in your
SquirrelMail setup. SquirrelMail developers don't support interface that removes
user information and should not be blamed when such interface is abused.

<sect1>Securing the connection to your IMAP server
<p>
SquirrelMail provides the option to connect to a remote IMAP server over
an encrypted connection: Transport Layer Security (TLS and STARTTLS),
or to connect with only encrypted user credentials (CRAM-MD5 and DIGEST-MD5).

Note: There is no point in using TLS if your IMAP server is localhost. You need
root to sniff the loopback interface, and if you don't trust root, or an attacker
already has root, the game is over. You've got a lot more to worry about beyond
having the loopback interface sniffed.

<sect2>Requirements
<p>
<sect3>CRAM/DIGEST-MD5
<p>
<itemize>
  <item>Digest-MD5 authentication needs PHP XML extension.
  <item>If you have the mhash extension to PHP, it will automatically be used,
        which may help performance on heavily loaded servers.
  <item>IMAP server support for these methods.
</itemize>

<sect3>TLS
<p>
<itemize>
  <item>PHP 4.3.0 or higher (Check Release Notes for PHP 4.3.x information)
  <item>The server you wish to use TLS on must have a dedicated port listening
        for TLS connections. (ie. port 993 for IMAP, 465 for SMTP).
  <item>If you use PHP 4.3.x, OpenSSL support must be compiled staticly. See
        <url url="http://bugs.php.net/bug.php?id=29934" name="PHP bug #29934">.
</itemize>

<sect3>STARTTLS
<p>
<itemize>
  <item>Available since SquirrelMail 1.5.1.
  <item>PHP 5.1.0rc1 or higher (stream_socket_enable_crypto() function)
  <item>Server with STARTTLS extension support
</itemize>

<sect2>Configuration
<p>
All configuration is done using conf.pl, under main menu option #2.
conf.pl can now attempt to detect which mechanisms your servers support.
You must have set the host and port before attempting to detect, or you
may get inaccurate results, or a long wait while the connection times out.

<sect2>Known Issues
<p>
DIGEST-MD5 has three different methods of operation. (qop options "auth",
"auth-int" and "auth-conf"). This implementation currently supports "auth"
only. Work is being done to add the other two modes.

<sect1>HTTP vs HTTPS
<p>
SquirrelMail interface consists of dynamically generated HTML pages. These pages
are transfered to user's browser using HTTP protocol. HTTP protocol does not
have any built-in encryption functions. Information is transfered in plain
text. HTTP traffic contains login passwords and any information viewed or
entered in browser.

If you want to secure web traffic, you should use HTTP protocol with SSL
encryption. Check your web server documentation about SSL support.

If you have SquirrelMail install in unsecured HTTP and secured HTTPS servers,
SquirrelMail secure_login and show_ssl_link plugins can be used to warn users
about insecure connections and/or provide automatic redirection to a secured server.

In the Apache webserver, redirection can be implemented with Redirect directives and
the mod_rewrite module. For example:

<tscreen><verb>
# Redirect /squirrelmail link to secured server
Redirect permanent /squirrelmail https://secured.example.org/squirrelmail
</verb></tscreen>

<tscreen><verb>
# simple mod_rewrite example
&lt;Location /squirrelmail&gt;
RewriteEngine on
RewriteCond %{HTTPS} !=on
RewriteRule .* https://%{HTTP_HOST}:443%{REQUEST_URI} [QSA,R=permanent,L]
&lt;/Location&gt;
</verb></tscreen>

HTTP over SSL communications prevent "man in the middle" attacks between user's
machine and webmail server. SSL encryption makes it difficult to sniff web
traffic. Use of signed SSL certificates might prevent hostname spoofing
attacks.

<sect1>Session data security
<p>
Information about OTP and other information stored in session.

<sect1>Data directory security
<p>
About data directory security.

<sect1>Keyloggers
<p>
vkeyboard plugin.

<sect>Adding accounts
<p>
<sect1>The problem
<p>
SquirrelMail can't be used to add user accounts, or to allow users to add their
own accounts, for three main reasons.

<itemize>
  <item>One of the SquirrelMail design goals is to do what it does very well,
        but to remain lean and simple.
  <item>User administration is very dependent on the server. A NT server with
        Exchange differs from a Linux server with Cyrus. There's no such thing
        as adding a SquirrelMail user; what you need to do is to add users to
        the IMAP server.
  <item>This would open a whole new (and unwanted) batch of security issues. One
        of those issues is giving your web server administrative access to your
        e-mail system.
</itemize>

SquirrelMail (without plugins) is just an IMAP client - nothing more. It merely
passes information to your IMAP server and formats it so it looks better to the
people logged in.

It is, however, possible to develop a tool that fits your environment and put a
link to it at your login page. Such a tool could either be a SquirrelMail plugin
or a detached application with the "look and feel" of SquirrelMail. The
internals of such a tool are system-specific, so you should consult the
documentation for your system and/or IMAP server. If you do develop it as a
plugin, we would love to list it on our plugins page.

<sect1>Existing solutions
<p>
In order to provide a free web mail sign up you can try one of these third party
solutions (listed in no particular order):

<enum>
  <item><url url="http://inter7.com/index.php?page=vpopmail" name="vpopmail">,
        <url url="http://inter7.com/index.php?page=vqregister" name="vqregister">,
        and <url url="http://inter7.com/index.php?page=vqsignup" name="vqsignup">.
    <itemize>
      <item>vpopmail provides a virtual user setup. User's information can be
            stored in file databases, a SQL database, or a LDAP directory.
            vqregister and vqsignup provide sign up scripts that use vpopmail
            libraries. This setup uses qmail or Courier MTA (SMTP servers) and
            the Courier IMAP server.
      <item>If you use vpopmail - you can use administration and automatic
            signup programs available at <url url="http://inter7.com"
            name="http://inter7.com">. If you have other type of setup (LDAP /
            MySQL / System users / other special local delivery program) - you
            need to write appropriate scripts that automate user management. As
            of version 3.0 of the Vadmin plugin (mentioned below), SQL-based
            backends are supported.
      <item>WARNING! inter7.com might require using other browsers than
            Microsoft Internet Explorer (typically <url
            url="http://mozilla.com/firefox/" name="Firefox">).
    </itemize>
  <item><url url="http://email.uoa.gr/projects/misc/uoa-signup/"
        name="UoA-Signup">.
    <itemize>
      <item>UoA-Signup is a simple signup script for inserting users in
            an LDAP directory. This setup uses the Sendmail MTA and the Cyrus
            IMAP server. For Cyrus, you would also need the autocreate patch.
            Setup can be customized for different MTAs (like Exim and Postfix).
            Note that UoA-Signup is a bit old and might not be supported.
    </itemize>
  <item><url url="http://untroubled.org/vmailmgr/" name="VMailMgr"> and the <url
        url="http://squirrelmail.org/plugin_view.php?id=3" name="Vadmin"> plugin
    <itemize>
      <item>The excellent Vadmin plugin was created to meet the needs of system
            administrators, and allows you to create new accounts and manage
            accounts. But as expected it requires a specific configuration (or a
            SQL backend system). Please note that this is contributed and not a
            part of SquirrelMail.
    </itemize>
  <item><url url="http://hmailserver.com/forum/viewtopic.php?t=904" name="hMailServer">
    <itemize>
      <item>There is a script and a small discussion in the forum about doing
            this (rather easily) with hMailServer as the mail server.
    </itemize>
</enum>

<sect1>Issues to consider
<p>
There are a couple of issues related to making an e-mail service open to the
public. Some of them are listed below.

<enum>
  <item>Accountability
    <itemize>
      <item>You must have end user agreements and procedures that deal with
            misuse of the interface.
    </itemize>
  <item>Performance
    <itemize>
      <item>The SquirrelMail requirements are not large, but certain PHP modules
            are required if you want a fast system.
      <item>You need to remove plugins that can increase the load at your
            server, and provide server side alternatives. For example, stock
            filters plugin should not be enabled on larger systems.
    </itemize>
  <item>Scalability
    <itemize>
      <item>Your system should be able to extend when the current server can't
            deal with the load. This would mean fast internal network (maybe 1
            Gb Ethernet) that contains separate authentication and storage
            servers and load balancing between several WWW/IMAP servers.
    </itemize>
  <item>Backups
    <itemize>
      <item>You will have to use RAID1 disks for storage and some special backup
            solution.
      <item>You will have to use at least two different internet providers in
            order to get reliable internet connection.
    </itemize>
  <item>Experience
    <itemize>
      <item>You need to understand how SquirrelMail works. You will need that
            knowledge in order to
        <itemize>
          <item>customize the interface to suit your site,
          <item>combine the stock and third party plugins, and
          <item>write your own plugins (you will most likely need at least one
                non-existent plugin or interface customization).
        </itemize>
    </itemize>
  <item>Finances
    <itemize>
      <item>You need money to allow you to keep your server farm running and pay
            your bills.
    </itemize>
</enum>

<sect>Solving problems
<sect1>Configtest
<p>
Using configtest.php as a first diagnose tool.
<sect1>Common PHP error messages
<sect2>unknown function session_id() call
<p>
missing session support

<sect2>Safe mode<label id="safe_mode">
<p>
TODO: Clean the Safe mode section up.

Running SquirrelMail with PHP <url url="http://php.net/features.safe-mode"
name="safe_mode"> restrictions.

Settings that are used in safe mode
<itemize>
  <item><tt/safe_mode/
  <item><tt/safe_mode_gid/
  <item><tt/safe_mode_include_dir/
  <item><tt/safe_mode_exec_dir/
  <item><tt/safe_mode_allowed_env_vars/
  <item><tt/safe_mode_protected_env_vars/
  <item><tt/disable_functions/
  <item><tt/disable_classes/
</itemize>

(<tt/open_basedir/ is related but functions independently of <tt/safe_mode/.)

It is possible to run SquirrelMail with <tt/safe_mode/ limitations, if you solve
some problems.

<em>1. safe_mode controls list of allowed executables.</em>

SquirrelMail has to use SMTP in order to send email or provider has to provide
wrapper for <tt>/usr/sbin/sendmail</tt>.

Fortune and SquirrelSpell plugins don't work, if provider does not add path to
fortune, ispell/aspell and cat programs into <tt/safe_mode_exec_dir/ variable.

Since <tt/safe_mode_exec_dir/ only allows only directory to be added, it is
necessary to create symbolic links from that directory to any other executables
required (for example, add a link to <tt>/usr/sbin/sendmail</tt> and
<tt>/bin/cat</tt> from <tt>/usr/bin</tt>).

Also, since under safe_mode <url url="http://php.net/function.exec"
name="exec()"> will only allow an executable to be called with a single
argument, the line:

<tscreen><verb>
exec("cat $floc | $sqspell_command 2>&amp;1", $sqspell_output, $sqspell_exitcode);
</verb></tscreen>

in <tt/check_me.mod/ will fail. It is necessary to create a shell script (in
<tt/safe_mode_exec_dir/) which takes as an argument the file to check, and then
call this instead. For example, the line could be changed to:

<tscreen><verb>
exec("squirrelmail_hack $floc", $sqspell_output, $sqspell_exitcode);
</verb></tscreen>

and then <tt>/usr/bin/squirrelmail_hack</tt> could be created as follows:

<tscreen><verb>
#!/bin/sh
# allow sqspell plugin to work with safe_mode
cat "$1" | /usr/bin/aspell pipe 2>&amp;1
</verb></tscreen>

and spellchecking will work. Note that language options will be ignored with
this script. It would also be possible to write something cleverer that splits
its argument by whitespace and calls the required dictionary. However, custom
user dictionaries will continue to work.

<em>2. safe_mode controls list of allowed environment variables.</em>

time zone settings are not available if use of TZ variable is not allowed.

gettext extension on some operating systems depends on environment variables.
SquirrelMail does not set them in safe mode.

<em>3. directory hashing does not work</em>

<em>4. path to data directory should be relative.</em>

SquirrelMail configuration tools allow relative paths only with one upper level.
Longer relative paths are converted to full path.

<em>5. mail_fetch plugin can't control PHP script execution time limits.</em>

Your email fetching time must be within PHP max_execution_time limits.

<em>6. File ownership restrictions</em>

Default preference file (frequently named <tt/default_pref/) AND the default
data directory (frequently <tt>/var/lib/squirrelmail/data/</tt>) must be owned
by same user that owns other SquirrelMail scripts. The default preference file
and the default data directory must be readable and writable by webserver's
user. The webserver's user and the owner of the SquirrelMail scripts may be
different (e.g. in Debian, SquirrelMail is owned by root, but the webserver runs
as www-data).

<sect1>UW IMAP
<sect2>Login Disabled
<p>
uw-imapd server disables plain text logins by default in 2002 and newer
versions. This was done in order to follow security recommendations by IETF (The
Internet Engineering Task Force) and strict RFC 3501 security recommendations.

You can see this by telneting to your IMAP server and checking for
LOGIN=DISABLED string in CAPABILITY description.

SquirrelMail uses plain text logins. In order to enable plain text logins, you
will have to recompile UW IMAP or use the semi-official /etc/c-client.cf
configuration file.

See doc/imaprc.txt for further information. In order to enable plain text
logins, you must add
<verb>
set disable-plaintext nil
</verb>

Please remember that you need to use specific phrase in first line of
/etc/c-client.cf. This phrase does not look like normal option, but uw imap will
refuse to parse other options, if this phrase is not present. Correct sentence
can be found in uw imap source or imaprc.txt document.

WARNING: uw imap developers discourage usage of /etc/c-client.cf options

<em>OS specific notes</em>
<descrip>
  <tag/Debian Sarge 3.1 and newer versions/
  Plain text logins are not enabled. See bugs
  <url url="http://bugs.debian.org/227709" name="227709">,
  <url url="http://bugs.debian.org/239537" name="239537">,
  <url url="http://bugs.debian.org/273687" name="273687">.

  Create c-client.cf file manually or <tt>dpkg-reconfigure uw-imapd</tt>, enable
  IMAPS and set SquirrelMail to use IMAP over SSL or use different IMAP server.

  <tag/OpenBSD/
  there are two different packaging flavors. [default package] and
  [package with plaintext support]. Use plaintext package or enable plain text
  login in <tt>/etc/c-client.cf</tt>

  <tag/FreeBSD/
  You need to recompile package from ports and set WITHOUT_SSL or
  WITH_SSL_AND_PLAINTEXT variables. You must remove prepackaged versions of
  imap-uw and cclient before doing this. If you don't want to recompile -
  enable plain text login in /etc/c-client.cf.

  <tscreen><verb>
  cd /usr/ports/mail/imap-uw
  env WITH_SSL_AND_PLAINTEXT=YES make
  </verb></tscreen>
</descrip>

If you don't want to enable plain text login, you must use IMAP-SSL server on
different port. Other programs support STARTTLS on default IMAP port, but
SquirrelMail can't do that due to specific limitations of PHP SSL module and
restrictions of SquirrelMail IMAP implementation. You may be able to use the
IMAPS port of 993.

Please note, that if your IMAP server is on the same host as webserver with
SquirrelMail, SSL adds security features that are useless. During connection to
localhost password information is not transmitted over unsafe network. If you
want to secure your IMAP server, bind it to localhost address only or use
tcpwrappers or firewall to disable external connections.

<sect2>Long listing
<p>
Configure SquirrelMail with UW preset and don't remove <tt>mail/</tt> prefix in
Folder Options.

<sect1>Common interface error messages
<sect2>Unknown username or password
<p>
password is not ********. you need cookies.

<sect2>Session timeout
<p>
session.gc_maxlifetime

<sect2>Can't delete emails. Quota exceeded.
<p>
SquirrelMail's default behavior is to move messages to the trash folder when
they are deleted. If mail account has a quota and user is close to exceeding it,
user might experience problems. IMAP protocol does not support move
command. This is what happens when message is deleted:

<enum>
  <item>The message is copied to the trashcan.
  <item>The original message is marked for deletion.
  <item>The original message is expunged, i.e. removed from the original folder.
</enum>

If user tries to delete message that exceeds left quota, operation is aborted
with quota error message.

Issue can be solved by deleting messages from trash or disabling use of Trash in
SquirrelMail.

<enum>
  <item>Click "Options".
  <item>Click "Folder Preferences".
  <item>Set "Trash Folder" to "Do not use Trash".
  <item>Click "Submit".
</enum>

When trash is disabled, user can delete unneeded messages and reduce total
amount of data stored in his/her account.

Starting with SquirrelMail 1.5.0 version, there is a "Bypass Trash" check box when
viewing the message list or a message's content, that can be used to delete
mails without changing the trash folder setting per above.

Some quota setups can ignore files placed in Trash folder.

<sect>FAQ
<p>
Daily questions

<sect>Support, feedback, and suggestions<label id="support">
<sect1>Before asking for support
<p>
First of all you should read the documentation. Apart from the documentation
included when installing SquirrelMail (you'll find it in <tt>doc/</tt>), and
the documentation for the end users (which is available through the "Help" link
in SquirrelMail), there are a few other useful resources:

<itemize>
  <item><url url="http://squirrelmail.org/documentation/" name="The SquirrelMail documentation">,
  <item><url url="http://squirrelmail.org/wiki/KnownBugs" name="Known bugs">, and
  <item><url url="http://squirrelmail.org/wiki/SolvingProblems" name="Solving problems">.
</itemize>

After reading the documentation there's one more thing to do: search for more
information on your own. The SquirrelMail Project has <ref id="mailinglists"
name="mailing list archives"> and <ref id="trackers" name="trackers"> which
contains useful information. The answers to your questions are likely to be
found there if not in the documentation. It's also recommended to use a search
engine, such as <url url="http://google.com/" name="Google">, or <url
url="http://squirrelmail.org/search.php" name="the SquirrelMail search page">.

Please use the tools described above, to make sure that you're not repeating a
question that have been asked before. Chances are that the answer you're looking
for is out there already.

<sect1>Needed details<label id="neededdetails">
<p>
To be able to get help solving your problem, you need to provide details about
it. The better details you provide, the easier it will become to find the
solution needed. Make it a rule to collect as much information as possible, even
if you think that it might be irrelevant. Having to ask about more details is
quite common and slows down the process, which most likely isn't what you want
when asking for support.

Everyone trying to solve a problem, regardless of what kind of problem it might
be, wants to know as much as possible about the various things that might affect
the situation at hand. Here are some details that's needed when asking for
SquirrelMail support.

<itemize>
  <item>SquirrelMail version (such as 1.4.0, 1.5.0, or 1.4.12-SVN from
        2007-10-04)
  <item>Every plugin installed (both names and version numbers)
  <item>PHP version (such as 4.2.0 or 5.2.4)
  <item>Web server (both brand and version number, such as Apache 1.3.27, or IIS
        5.0)
  <item>IMAP server (both brand and version number, such as Courier-IMAP 4.2.0,
        UW IMAP as packaged by Debian as "uw-imapd (7:2002edebian1-13.1)", or
        Microsoft Exchange Server 2003)
  <item>SMTP server (both brand and version number, such as Sendmail 8.14.1, or
        Postfix as packaged by FreeBSD as "postfix-2.4.5,1")
  <item>OS and, if applicable, distribution (such as Debian GNU/Linux 4.0 for
        i386 (kernel "linux-image-2.6.18-4-686 (2.6.18.dfsg.1-12etch2)"), Red
        Hat Enterprise Linux 5.0.0 for PPC, NetBSD 3.1 for ARM, or Windows 2000)
  <item>How your software was installed, including the package name if
        applicable (Fedora 7 "dovecot-1.0.1-12.fc7" installed by RPM, or
        SquirrelMail 1.4.11 installed manually)
  <item>Browsers tried (both brand and version, such as Firefox 2.0.0.7, or
        Internet Explorer 7.0.6000.16512)
  <item>Any things that might make your install different, even if minor (such
        as web server rewrite rules, configuration files, load balancers, and
        proxies)
  <item><ref id="errormessages" name="Error messages"> (see below)
</itemize>

The bug report plugin (bundled with SquirrelMail) collects a number of useful
details. Make sure that the data provided by it is part of your request for
support.

Read more about how to ask for support in a smart way at <url
url="http://www.catb.org/~esr/faqs/smart-questions.html" name="How to Ask
Questions the Smart Way"> and <url
url="http://www.chiark.greenend.org.uk/~sgtatham/bugs.html" name="How to Report
Bugs Effectively">. Those pages are general suggestions applicable to almost all
open source software, not only the SquirrelMail Project, and aren't maintained
by the SquirrelMail Project Team.

Remember that details are of the essence, and it's close to impossible to give
too many of them.

<sect2>Error Messages<label id="errormessages">
<p>
When you are getting errors from SquirrelMail, PHP, your IMAP logs, or any
other source, please copy and paste the <em/exact/ message text from <em/all/
error messages. Error messages from the SMTP or IMAP servers can usually be
found in the system mail log, which might be in a place such as
<tt>/var/log/maillog</tt>, and PHP errors might be found in the web server logs
(sometimes in a file such as <tt>/var/log/httpd/error_log</tt>), or by turning
PHP error displays on by either using the <url
url="http://squirrelmail.org/plugin_view.php?id=228" name="Debugger plugin"> or
by editing <tt/php.ini/ (<tt/display_errors=On/ and <tt/error_reporting=E_ALL/)
and restarting your web server.

The suggested logs above might not be applicable for your system, so check your
system documentation if you don't know where to find the error messages.

<sect1>Posting guidelines
<p>
In addition to the sections above, there are some extra things to think about
when using the mailing lists.

<descrip>
  <tag/Discuss SquirrelMail/
    All the lists are related to SquirrelMail, so please don't use them for
    non-related topics. If, for some reason, you <em/have/ to post something off
    topic, please mark that post with "OT" in the subject line.
  <tag/Post in plain text/
    Disable HTML posting in your mail client when posting the mailing lists.
    Most archive tools can't handle HTML, so try to describe your problem with
    words in plain text, and not in colors and such.
  <tag/Use a meaningful subject line/
    See "<ref id="choosingsubject" name="Choosing a subject line">".
  <tag/Use inline replying/
    People may argue the pros and cons for various posting styles, such as
    top-posting, bottom-posting, and double quoting, but use inline replying
    when mailing to the SquirrelMail mailing lists. Remember that any mail you
    send isn't just useful now and for yourself. When searching the archives
    months later, being able to read a mail top-down is much easier than having
    to jump back and forth in the mail to get the context. More information can
    be found in <url url="http://en.wikipedia.org/wiki/Posting_style"
    name="Wikipedia's article on posting style">.
  <tag/Trim your replies/
    Remove irrelevant lines from your replies, such as footers, but leave enough
    for someone to understand the context when searching the archives.
  <tag/Link to images, don't attach them/
    Try not to use images, but sometimes a picture says more than a thousand
    words. In those cases, please refrain from attaching your picture.
    Publishing it at the web and providing a link to it helps keeping the list
    volume down.
  <tag/Only describe one problem per thread/
    Don't describe more than one problem per thread. That helps when choosing a
    fitting subject and is more useful when searching the archives.
  <tag/Start a new thread when having a new problem/
    Don't reply to a thread when your own post is not related to it, also known
    as "hijacking threads". This is valid even if you change both the subject
    and the mail body, since the other headers (which you can't change from your
    client) will make your post appear in the thread you're replying to. Always
    start a new thread from scratch.
  <tag/Be patient/
    Don't expect to get a reply within minutes. Wait at least 24 hours before
    posting the same mail again. If you're impatient, you might want to consider
    getting <ref id="commercialsupport" name="commercial support"> instead.
</descrip>

Remember to follow <url url="http://faqs.org/rfcs/rfc1855.html" name="RFC 1855 -
Netiquette Guidelines"> as much as possible, unless it clashes with the
guidelines above.

<sect2>Choosing a subject line<label id="choosingsubject">
<p>
Make sure to use a subject line that describes the problem at hand. Putting
"Help" is a poor description, but something like "Connection dropped by IMAP on
login attempts" is more useful, both for you, the people trying to help you, and
other people searching the archives since they have similar issues.

To make the mailing list archives easier to search and use, please keep the
following in mind when choosing a subject for your post to the mailing list:

<itemize>
  <item>Not everyone wants to read every message. A good subject lets readers
        know the subject without opening the message.
  <item>The mailing list archives serve as a form of self-generating
        documentation. The better your subject line, the more likely someone
        will learn from your post or reply.
  <item>If you are certain that the problem is related to a specific plugin, you
        should include the plugin name in the subject line.
  <item>If you are writing a reply, try to preserve the sender's original
        subject (unless it is the generic "no subject") as this helps preserve
        threading if other reply mechanisms do not.
</itemize>

Some examples of <em/good/ subject lines:

<itemize>
  <item>Warnings with today's SVN trunk
  <item>SquirrelMail 1.0.1 doesn't work with PHP 4.0.1p1
  <item>Re: SquirrelMail 1.0.1 doesn't work with PHP 4.0.1p1
  <item>compose.php won't load in Mozilla
  <item>mail_fetch plugin 1.4.9a hangs checking for messages
  <item>Subject line does not appear when sending mail to oneself
</itemize>

Some examples of <em/too generic/ subject lines which violates the policy:

<itemize>
  <item>SquirrelMails
  <item>Problem (or variations thereof, like "I have a problem" or "SquirrelMail
        Problem")
  <item>Error
  <item>(No Subject)
  <item>squirrelmail-devel digest, Vol x #xxxx - x msgs
</itemize>

<sect1>Free support<label id="freesupport">
<p>
Before contacting the free support, which is provided by the SquirrelMail
Project Team and the SquirrelMail community, make sure that the prerequisites
are fulfilled. Please note that this free service is "best effort only", i.e.
please do not demand answers within a certain timeframe in the same way as when
you have a <ref id="commercialsupport" name="commercial support agreement">.

Please note that the free support only covers the SquirrelMail software, and not
any other problems that you might have regarding sending or receiving mail with
your employer's or ISP's particular installation. Problems such as "My mail
keeps bouncing", "How come the boss didn't get my big proposal? Fix it!", or
"Why are you blocking my mail?" is akin to asking the folks who built the road
why your car's running poorly.

There are three ways to contact the SquirrelMail Project Team: the <ref
id="mailinglists" name="mailing lists">, the <ref id="trackers"
name="trackers">, and the <ref id="irc" name="Internet Relay Chat channel">. The
<ref id="neededdetails" name="information needed"> is applicable to all of them.
If you're not sure which method to use, you're most likely best off trying the
mailing lists first.

<sect2>The mailing lists<label id="mailinglists">
<p>
If you have general questions, comments, or suggestions please send them to our
mailing lists. The SquirrelMail Project Team actively monitors the lists, and
you should get replies within a reasonable time. The available lists are listed
below.

When you try to join a list, a confirmation mail will be sent to you. Simply
reply to that confirmation message (leaving the subject line intact), and you
will be subscribed. Remember that you must be a member of a mailing list in
order to post to it.

<tabular ca="lccc">
<bf/Mailing list/|<bf/Description/|<bf/Subscribe/|<bf/Archives/@
SquirrelMail Announcement Mailing List|Very low traffic, moderated, announcements only.|<url url="http://lists.sourceforge.net/mailman/listinfo/squirrelmail-announce" name="Subscribe">|<url url="http://sourceforge.net/mailarchive/forum.php?forum_name=squirrelmail-announce" name="S"> <url url="http://marc.info/?l=squirrelmail-announce" name="M"> <url url="http://dir.gmane.org/gmane.mail.squirrelmail.announce" name="G"> <url url="http://www.nabble.com/squirrelmail-announce-f4373.html" name="N">@
SquirrelMail CVS Mailing List (legacy name)|Messages are sent with every change in the repository.|<url url="http://lists.sourceforge.net/mailman/listinfo/squirrelmail-cvs" name="Subscribe">|<url url="http://sourceforge.net/mailarchive/forum.php?forum_name=squirrelmail-cvs" name="S"> <url url="http://marc.info/?l=squirrelmail-cvs" name="M"> <url url="http://dir.gmane.org/gmane.mail.squirrelmail.cvs" name="G"> N@
SquirrelMail Development Mailing List|For discussing the development of SquirrelMail and patches.|<url url="http://lists.sourceforge.net/mailman/listinfo/squirrelmail-devel" name="Subscribe">|<url url="http://sourceforge.net/mailarchive/forum.php?forum_name=squirrelmail-devel" name="S"> <url url="http://marc.info/?l=squirrelmail-devel" name="M"> <url url="http://dir.gmane.org/gmane.mail.squirrelmail.devel" name="G"> <url url="http://www.nabble.com/squirrelmail-devel-f4374.html" name="N">@
SquirrelMail Internationalization Mailing List|Questions and discussions concerning translations, character sets, etc.|<url url="http://lists.sourceforge.net/mailman/listinfo/squirrelmail-i18n" name="Subscribe">|<url url="http://sourceforge.net/mailarchive/forum.php?forum_name=squirrelmail-i18n" name="S"> <url url="http://marc.info/?l=squirrelmail-i18n" name="M"> <url url="http://dir.gmane.org/gmane.mail.squirrelmail.internationalization" name="G"> <url url="http://www.nabble.com/squirrelmail-i18n-f4375.html" name="N">@
SquirrelMail Mailing List in Spanish|For those of us who prefer Spanish.|<url url="http://lists.sourceforge.net/mailman/listinfo/squirrelmail-lang-es" name="Subscribe">|<url url="http://sourceforge.net/mailarchive/forum.php?forum_name=squirrelmail-lang-es" name="S"> <url url="http://marc.info/?l=squirrelmail-lang-es" name="M"> G <url url="http://www.nabble.com/squirrelmail-lang-es-f4376.html" name="N">@
SquirrelMail Plugins Mailing List|For help with using and developing SquirrelMail plugins.|<url url="http://lists.sourceforge.net/mailman/listinfo/squirrelmail-plugins" name="Subscribe">|<url url="http://sourceforge.net/mailarchive/forum.php?forum_name=squirrelmail-plugins" name="S"> <url url="http://marc.info/?l=squirrelmail-plugins" name="M"> <url url="http://dir.gmane.org/gmane.mail.squirrelmail.plugins" name="G"> <url url="http://www.nabble.com/squirrelmail-plugins-f4377.html" name="N">@
SquirrelMail Stable Series Mailing List|This list is inactive, but the archives still exist.|Inactive|<url url="http://sourceforge.net/mailarchive/forum.php?forum_name=squirrelmail-stable" name="S"> <url url="http://marc.info/?l=squirrelmail-stable" name="M"> G N@
SquirrelMail Users Mailing List (legacy name)|Despite its name, this list is intended for supporting administrators and not end users. This is the main list, dealing mostly with administrating SquirrelMail and general feedback.|<url url="http://lists.sourceforge.net/mailman/listinfo/squirrelmail-users" name="Subscribe">|<url url="http://sourceforge.net/mailarchive/forum.php?forum_name=squirrelmail-users" name="S"> <url url="http://marc.info/?l=squirrelmail-users" name="M"> <url url="http://dir.gmane.org/gmane.mail.squirrelmail.user" name="G"> <url url="http://www.nabble.com/squirrelmail-users-f4380.html" name="N">
</tabular>

Legend: S = SourceForge, M = MARC, G = Gmane, N = Nabble (there's also an <url
url="http://www.nabble.com/SquirrelMail-f4372.html" name="all-in-one">
interface for all list archives at Nabble).

The subscription interface for <url
url="http://sourceforge.net/mail/?group_id=311" name="all mailing lists"> can
also be found at the project site at SourceForge.

<sect2>The trackers<label id="trackers">
<p>
The SquirrelMail Project uses trackers to manage bugs, patches and feature
requests. Using a tracker instead of the mailing lists prevent your patches,
feature requests, and bug reports from "getting drowned" in the amount of mails
at the lists. Try to use the trackers only when reporting new, not previously
addressed issues. If you're not sure whether to use the mailing lists or the
trackers, ask for advice at the mailing lists.

<tabular ca="ll">
<bf/Tracker/|<bf/Use/@
<url url="http://squirrelmail.org/bugs/" name="Bug reports">|For reporting newly discovered bugs not solved in the latest version of SquirrelMail.@
<url url="http://squirrelmail.org/features/" name="Feature requests">|For requesting features not provided by the latest version of SquirrelMail or any available plugins.@
<url url="http://squirrelmail.org/patches/" name="Patches">|For providing patches against a recent repository version of SquirrelMail. See the <url url="http://squirrelmail.org/docs/devel/devel.html" name="SquirrelMail Developer's Manual"> for more information about patches.
</tabular>

A list of <url url="http://squirrelmail.org/trackers/" name="all trackers"> can
be found at the project site at SourceForge.

<sect2>The Internet Relay Chat channel<label id="irc">
<p>
The SquirrelMail Project has an <url url="irc://irc.freenode.net/squirrelmail"
name="Internet Relay Chat channel">. It can be used to get support on a best
effort basis. Ask your question and wait patiently - someone will answer it
eventually. Keep in mind that even if the channel appears populated, most of the
users are away from their keyboards (AFK) most of the time. And no, typing
"Hello?" won't get them back any quicker - it's better to describe what you need
help with.

For those interested, there's a page with <url
url="http://squirrelmail.org/wiki/InternetRelayChat" name="nickname mapping"> in
the wiki.

<sect1>Commercial support<label id="commercialsupport">
<p>
There are <url url="http://squirrelmail.org/wiki/CommercialSupport" name="third
party companies that provide commercial support and service level agreements">
for SquirrelMail installations. These companies make their living supporting
open source software for a fee, so don't call them asking for free support.
Depending on the services they provide, they might not require you to do as much
research on your own as when asking for free support, and you might be able to
have guaranteed response and resolution times as well (check your support
contact for the details).

<sect1>Security issues<label id="security">
<p>
The SquirrelMail Project takes security very seriously. If you think you've
discovered a security-related issue in SquirrelMail, i.e. something that's a
problem for <em/all/ users installing and using SquirrelMail, please contact the
SquirrelMail Project Team directly. The developers will do their best to work
with you towards a solution as quickly as possible and will of course give all
credit where it's due.

A list of already solved SquirrelMail security issues and the contact
information for security issues can be found at the <url
url="http://squirrelmail.org/security/" name="SquirrelMail security page">.

<sect>Presets<label id="presets">
<p>
This chapter lists SquirrelMail options set by D option in SquirrelMail
configuration utility.

It can be used if user can't run configuration utility and changes options
manually. Settings can be different if IMAP server uses shared folders.

Possible server values are:
<itemize>
  <item>bincimap = Binc IMAP server
  <item>courier = Courier IMAP server
  <item>cyrus = Cyrus IMAP server
  <item>dovecot = Dovecot Secure IMAP server
  <item>exchange = Microsoft Exchange IMAP server
  <item>hmailserver = hMailServer
  <item>macosx = Mac OS X Mailserver
  <item>mercury32 = Mercury/32
  <item>uw = University of Washington's IMAP server
</itemize>

<sect1>default settings
<p>
These are generic settings that should work in some IMAP servers.

<p>
<itemize>
  <item>imap_server_type = other
  <item>default_folder_prefix = none (is set to empty string)
  <item>trash_folder = INBOX.Trash
  <item>sent_folder = INBOX.Sent
  <item>draft_folder = INBOX.Drafts
  <item>show_prefix_option = false
  <item>default_sub_of_inbox = true
  <item>show_contain_subfolders_option = false
  <item>optional_delimiter = detect
  <item>delete_folder = false
  <item>force_username_lowercase = false
</itemize>

<sect1>cyrus preset
<p>
This preset is written for Cyrus IMAP.

<p>
<itemize>
  <item>imap_server_type = cyrus
  <item>default_folder_prefix = none (is set to empty string)
  <item>trash_folder = INBOX.Trash
  <item>sent_folder = INBOX.Sent
  <item>draft_folder = INBOX.Drafts
  <item>show_prefix_option = false
  <item>default_sub_of_inbox = true
  <item>show_contain_subfolders_option = false
  <item>optional_delimiter = .
  <item>delete_folder = true
  <item>force_username_lowercase = false
</itemize>

<sect1>uw preset
<p>
This preset is written for UW IMAPD.

<p>
<itemize>
  <item>imap_server_type = uw
  <item>default_folder_prefix = mail/
  <item>trash_folder = Trash
  <item>sent_folder = Sent
  <item>draft_folder = Drafts
  <item>show_prefix_option = true
  <item>default_sub_of_inbox = false
  <item>show_contain_subfolders_option = true
  <item>optional_delimiter = /
  <item>delete_folder = true
  <item>force_username_lowercase = true
</itemize>

<sect2>Comments
<p>
<itemize>
  <item>Since v.2002 UW IMAPD disabled plain text logins in default
  configuration. SquirrelMail can't use STARTTLS features provided by default
  server configuration. You might have to run IMAPS (IMAP over SSL) service or
  enable plain text logins.
</itemize>

<sect1>exchange preset
<p>
This preset is written for Microsoft Exchange IMAP server.

<p>
<itemize>
  <item>imap_server_type = exchange
  <item>default_folder_prefix = none (is set to empty string)
  <item>trash_folder = INBOX/Deleted Items
  <item>sent_folder = INBOX/Sent Items
  <item>draft_folder = Drafts
  <item>show_prefix_option = false
  <item>default_sub_of_inbox = true
  <item>show_contain_subfolders_option = false
  <item>optional_delimiter = detect
  <item>delete_folder = true
  <item>force_username_lowercase = true
</itemize>

<sect1>courier preset
<p>
This preset is written for Courier IMAP server.

<p>
<itemize>
  <item>imap_server_type = courier
  <item>default_folder_prefix = INBOX.
  <item>trash_folder = Trash
  <item>sent_folder = Sent
  <item>draft_folder = Drafts
  <item>show_prefix_option = false
  <item>default_sub_of_inbox = false
  <item>show_contain_subfolders_option = false
  <item>optional_delimiter = .
  <item>delete_folder = true
  <item>force_username_lowercase = false
</itemize>

<sect1>macosx preset
<p>
This preset is written for IMAP server used by MacOS X

<p>
<itemize>
  <item>imap_server_type = macosx
  <item>default_folder_prefix = INBOX/
  <item>trash_folder = Trash
  <item>sent_folder = Sent
  <item>draft_folder = Drafts
  <item>show_prefix_option = false
  <item>default_sub_of_inbox = true
  <item>show_contain_subfolders_option = false
  <item>optional_delimiter = detect
  <item>delete_folder = true
  <item>force_username_lowercase = false
</itemize>

<sect1>hmailserver preset
<p>
This preset is written for hMailServer

<p>
<itemize>
  <item>imap_server_type = hmailserver   (used in imap_search.php)
  <item>default_folder_prefix = none (is set to empty string)
  <item>trash_folder = INBOX.Trash
  <item>sent_folder = INBOX.Sent
  <item>draft_folder = INBOX.Drafts
  <item>show_prefix_option = false
  <item>default_sub_of_inbox = true
  <item>show_contain_subfolders_option = false
  <item>optional_delimiter = detect
  <item>delete_folder = false
  <item>force_username_lowercase = false
</itemize>

<sect1>mercury32 preset
<p>
This preset is used for Mercury Mail Transport System. Preset is available since
SquirrelMail 1.5.0. It was tested on Mercury32 v.4.01b

<p>
<itemize>
  <item>imap_server_type = mercury32
  <item>default_folder_prefix = none (is set to empty string)
  <item>trash_folder = Trash
  <item>sent_folder = Sent
  <item>draft_folder = Drafts
  <item>show_prefix_option = false
  <item>default_sub_of_inbox = true
  <item>show_contain_subfolders_option = true
  <item>optional_delimiter = detect
  <item>delete_folder = true
  <item>force_username_lowercase = true
</itemize>

<sect2>Comments
<p>
<itemize>
  <item>Server side sorting and threading are not supported.
  <item>Message flags are not supported.
  <item>IMAP folders can store messages _or_ other folders.
  <item>Supports STARTTLS, if configured.
  <item>May have issues with 8bit IMAP folder names.
</itemize>

$imap_server_type variable is used to handle imap folder subscription
differences.

Site URL: <url url="http://pmail.com" name="http://pmail.com">

<sect1>dovecot preset
<p>
Preset used for Dovecot Secure IMAP server. It is available since SquirrelMail
1.5.1. There is no code specific to Dovecot IMAP server. Preset provides only a
quick way to set correct folder settings. Tested on Dovecot v.0.99.14

<p>
<itemize>
  <item>imap_server_type = dovecot
  <item>default_folder_prefix = none (is set to empty string)
  <item>trash_folder = Trash
  <item>sent_folder = Sent
  <item>draft_folder = Drafts
  <item>show_prefix_option = false
  <item>default_sub_of_inbox = false
  <item>show_contain_subfolders_option = false
  <item>optional_delimiter = detect
  <item>delete_folder = false
  <item>force_username_lowercase = true
</itemize>

<sect2>Comments
<p>
<itemize>
  <item>IMAP server supports server side sorting and threading.
</itemize>

<sect1>bincimap preset
<p>
Preset is used with Binc IMAP server. Available since SquirrelMail 1.5.1.
Due to available storage backend configuration options it is impossible
to create single preset, which covers all setups.

<sect2>Default (1.2.13) configuration with Maildir++ depot and / delimiter
<p>
<itemize>
  <item>imap_server_type = bincimap (is used to handle INBOX in folder management)
  <item>default_folder_prefix = INBOX/
  <item>trash_folder = Trash
  <item>sent_folder = Sent
  <item>draft_folder = Drafts
  <item>show_prefix_option = false
  <item>default_sub_of_inbox = false
  <item>show_contain_subfolders_option = false
  <item>optional_delimiter = / (can be set to 'detect')
  <item>delete_folder = true
  <item>force_username_lowercase = false (depends on checkpassword)
</itemize>

<sect2>Default (1.3.4) configuration with IMAPdir depot - same as dovecot ?
<p>
<itemize>
  <item>imap_server_type = bincimap
  <item>default_folder_prefix = none (is set to empty string)
  <item>trash_folder = Trash
  <item>sent_folder = Sent
  <item>draft_folder = Drafts
  <item>show_prefix_option = false
  <item>default_sub_of_inbox = false
  <item>show_contain_subfolders_option = false
  <item>optional_delimiter = / (can be set to 'detect')
  <item>delete_folder = true
  <item>force_username_lowercase = false (depends on checkpassword)
</itemize>

<sect2>Configuration with Maildir++ depot and . delimiter
<p>
Use courier preset.

<sect2>Comments
<p>
<itemize>
  <item>IMAP server does not support server side sorting and threading.
  <item>Plain text logins are disabled by default.
</itemize>

<sect>Links
<p>
This chapter provides links to some commonly used software and documents.

<sect1>RFC<label id="rfc">
<p>
The Requests for Comments (RFC) document series is a set of technical and
organizational notes about the Internet (originally the ARPANET), beginning in
1969. Memos in the RFC series discuss many aspects of computer networking,
including protocols, procedures, programs, and concepts, as well as meeting
notes, opinions, and sometimes humor.

These documents are available on many sites. For example:
<itemize>
  <item><url url="http://www.ietf.org/rfc.html" name="IETF">
  <item><url url="http://www.rfc-editor.org/rfc.html" name="RFC Editor">
  <item><url url="http://www.faqs.org/rfcs/" name="Internet FAQ Archives">
</itemize>

You might be able to find nearby RFC site by searching for 'rfc somenumber' in
your favorite search engine.

<sect1>SquirrelMail sites
<p>
List of sites and projects related to SquirrelMail

<itemize>
  <item><url url="http://squirrelmail.org" name="SquirrelMail site">
  <item><url url="http://sourceforge.net/projects/sm-plugins/" name="SM-Plugins
  project">
  <item><url url="http://sourceforge.net/projects/vadmin-plugin/" name="Vadmin
  plugin">
  <item><url url="http://sourceforge.net/projects/sasql/" name="SASql plugin">
  <item><url url="http://sourceforge.net/projects/retruserdata/"
  name="RetrieveUserData plugin">
  <item><url url="http://sourceforge.net/projects/serverfilters/" name="Server
  Side Filters plugin">
  <item><url url="http://sourceforge.net/projects/attachment-doc/"
  name="Attachment Doc plugin">
  <item><url url="http://sourceforge.net/projects/sqdeskplugins/"
  name="SquirrelMail desktop plugins">
  <item><url url="http://sourceforge.net/projects/secure-webmail/" name="SWM">
  <item><url url="http://www.braverock.com/gpg/" name="GPG plugin">
  <item><url url="http://www.sqmail.org" name="sqmail.org site">
  <item><url url="http://www.email.uoa.gr/projects/squirrelmail" name="University of Athens Squirrelmail projects (such as plugins avelsieve, useracl and ldapuserdata)">
  <item><url url="http://messinet.com/node/94" name="The PHP-Nuke SquirrelMail login block">
</itemize>

<sect1>IMAP servers
<p>
<itemize>
  <item><url url="http://www.courier-mta.org" name="Courier">
  <item><url url="http://cyrusimap.web.cmu.edu" name="Cyrus IMAPd">
  <item><url url="http://www.washington.edu/imap/" name="UW IMAP">
  <item><url url="http://www.bincimap.org" name="Binc IMAP">
  <item><url url="http://www.dovecot.org" name="Dovecot">
  <item><url url="http://www.dbmail.org" name="DBMail">
</itemize>

<sect>Licensing and warranty
<p>
SquirrelMail is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.

SquirrelMail is distributed in the hope that it will be useful,
but <em>without any warranty</em>; without even the implied warranty of
<em>merchantability</em> or <em>fitness for a particular purpose</em>.
See the GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with SquirrelMail; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
02110-1301, USA

</article>
